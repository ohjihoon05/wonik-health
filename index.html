<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wonik Health</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background: #fafafa;
            min-height: 100vh;
            color: #1a1a1a;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 32px;
            background: #ffffff;
            min-height: 100vh;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0 0 8px 0;
            color: #1a1a1a;
            text-align: center;
        }

        .subtitle {
            font-size: 1.1rem;
            margin-bottom: 48px;
            color: #6b7280;
            text-align: center;
        }

        .status {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            margin: 24px 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .success {
            color: #059669;
            font-weight: 600;
        }

        .version-info {
            margin-top: 48px;
            font-size: 0.875rem;
            color: #9ca3af;
            text-align: center;
            padding: 24px;
            border-top: 1px solid #e5e7eb;
        }

        .emoji {
            font-size: 3rem;
            margin-bottom: 16px;
            display: block;
            text-align: center;
        }

        .test-btn {
            background: #059669;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 0.875rem;
            font-weight: 500;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s ease;
            font-family: inherit;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .test-btn:hover {
            background: #047857;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .test-btn:active {
            background: #065f46;
            transform: translateY(1px);
        }

        /* ë¯¸ë‹ˆë©€ ì¹´ë“œ ì‹œìŠ¤í…œ */
        .medication-form, .medication-list {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 24px;
            margin: 16px 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.15s ease;
        }

        .medication-form h3, .medication-list h3 {
            margin: 0 0 20px 0;
            color: #1a1a1a;
            font-size: 1.25rem;
            font-weight: 600;
            text-align: left;
        }

        .form-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: end;
        }

        .form-input {
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: #ffffff;
            color: #1a1a1a;
            font-size: 0.875rem;
            flex: 1;
            min-width: 150px;
            transition: border-color 0.15s ease;
        }

        .form-input::placeholder {
            color: #9ca3af;
        }

        .form-input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .add-btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.15s ease;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .add-btn:hover {
            background: #1d4ed8;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        /* Magic MCP ìŠ¤íƒ€ì¼ í†µí•© - ì•½ë¬¼ ì¹´ë“œ */
        .medication-item {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            margin: 12px 0;
            transition: all 0.15s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }


        .medication-item:hover {
            border-color: #d1d5db;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }



        .medication-info {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .medication-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 12px;
        }

        .medication-name {
            font-size: 1rem;
            font-weight: 600;
            color: #1a1a1a;
            margin: 0;
        }

        .dosage-badge {
            padding: 4px 8px;
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 500;
            color: #1d4ed8;
        }

        .medication-details {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.875rem;
            color: #6b7280;
        }

        .time-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            background: #f3f4f6;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        /* ì•¡ì…˜ ë²„íŠ¼ë“¤ */
        .action-buttons {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-top: 12px;
        }

        /* ë¯¸ë‹ˆë©€ ë²„íŠ¼ */
        .neomorphic-btn {
            border: 1px solid #d1d5db;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.75rem;
            transition: all 0.15s ease;
            background: #ffffff;
            color: #374151;
        }

        .schedule-med-btn {
            flex: 1;
            height: 32px;
            background: #2563eb;
            color: #ffffff;
            padding: 6px 12px;
            border: none;
        }

        .delete-btn {
            width: 32px;
            height: 32px;
            background: #ef4444;
            color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
        }

        /* ë²„íŠ¼ í˜¸ë²„ íš¨ê³¼ */
        .neomorphic-btn:hover {
            border-color: #9ca3af;
        }

        .schedule-med-btn:hover {
            background: #1d4ed8;
        }
        
        .delete-btn:hover {
            background: #dc2626;
        }

        /* íŒ¨í„´ ë¶„ì„ ìŠ¤íƒ€ì¼ */
        .analytics-area {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 24px;
            margin: 16px 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .today-summary, .weekly-pattern, .insights-section, .recommendations, .data-management {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin: 16px 0;
        }

        .today-summary h4, .weekly-pattern h4, .insights-section h4, .recommendations h4, .data-management h4 {
            margin: 0 0 16px 0;
            color: #374151;
            font-weight: 600;
            font-size: 1.125rem;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .summary-card {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.15s ease;
        }

        .summary-card:hover {
            border-color: #d1d5db;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .summary-icon {
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f3f4f6;
            border-radius: 8px;
        }

        .summary-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .summary-label {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .summary-value {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1a1a1a;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .chart-header span {
            font-weight: 500;
            color: #374151;
        }

        #week-selector {
            padding: 6px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: #ffffff;
            color: #1a1a1a;
            font-size: 0.875rem;
        }

        .weekly-bars {
            display: flex;
            justify-content: space-between;
            align-items: end;
            height: 200px;
            gap: 8px;
            padding: 20px 0;
            border-top: 1px solid #e5e7eb;
            border-bottom: 1px solid #e5e7eb;
        }

        .day-bar {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .bar-container {
            width: 100%;
            height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: end;
            position: relative;
        }

        .work-bar {
            background: #2563eb;
            border-radius: 4px 4px 0 0;
            min-height: 4px;
        }

        .rest-bar {
            background: #10b981;
            border-radius: 0 0 4px 4px;
            min-height: 4px;
        }

        .day-label {
            font-size: 0.75rem;
            color: #6b7280;
            font-weight: 500;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
        }

        .insight-card {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
        }

        .insight-card.positive {
            border-left: 4px solid #10b981;
        }

        .insight-card.warning {
            border-left: 4px solid #f59e0b;
        }

        .insight-card.negative {
            border-left: 4px solid #ef4444;
        }

        .insight-title {
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 8px;
        }

        .insight-description {
            font-size: 0.875rem;
            color: #6b7280;
            line-height: 1.5;
        }

        .recommendation-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .recommendation-item {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            display: flex;
            align-items: start;
            gap: 12px;
        }

        .recommendation-icon {
            font-size: 1.25rem;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #eff6ff;
            border-radius: 6px;
            flex-shrink: 0;
        }

        .recommendation-content {
            flex: 1;
        }

        .recommendation-title {
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 4px;
        }

        .recommendation-text {
            font-size: 0.875rem;
            color: #6b7280;
            line-height: 1.5;
        }

        .data-actions {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .data-info {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .data-info p {
            margin: 4px 0;
        }

        .data-info span {
            font-weight: 500;
            color: #374151;
        }

        .empty-state {
            text-align: center;
            color: #9ca3af;
            padding: 24px;
            font-style: italic;
            font-size: 0.875rem;
        }

        /* ì•Œë¦¼ í…ŒìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .notification-test {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 24px;
            margin: 16px 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .notification-test h3 {
            margin: 0 0 20px 0;
            color: #1a1a1a;
            font-size: 1.25rem;
            font-weight: 600;
            text-align: left;
        }

        .test-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        .test-controls label {
            font-size: 0.875rem;
            color: #374151;
            font-weight: 500;
        }

        #test-delay {
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: #ffffff;
            color: #1a1a1a;
            font-size: 0.875rem;
        }

        #test-delay option {
            background: #ffffff;
            color: #1a1a1a;
        }

        .schedule-btn {
            background: #f59e0b;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.15s ease;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .schedule-btn:hover {
            background: #d97706;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .scheduled-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .scheduled-item {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .scheduled-info {
            flex: 1;
        }

        .countdown {
            font-weight: 600;
            color: #f59e0b;
            margin-left: 10px;
        }

        .cancel-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 500;
            transition: all 0.15s ease;
        }

        .cancel-btn:hover {
            background: #dc2626;
        }

        .schedule-med-btn {
            background: linear-gradient(145deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 4px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-left: 10px;
            transition: all 0.3s ease;
        }

        .schedule-med-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(16, 185, 129, 0.4);
        }

        /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ */
        .tab-navigation {
            display: flex;
            gap: 2px;
            margin: 24px 0;
            background: #f3f4f6;
            border-radius: 8px;
            padding: 4px;
        }

        .tab-btn {
            flex: 1;
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            background: transparent;
            color: #6b7280;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            font-family: inherit;
        }

        .tab-btn.active {
            background: #ffffff;
            color: #1a1a1a;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            font-weight: 600;
        }

        .tab-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.5);
            color: #374151;
        }

        /* íƒ­ ì½˜í…ì¸  ìŠ¤íƒ€ì¼ */
        .tab-content {
            position: relative;
        }

        .tab-panel {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-panel.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ì—…ë¬´ ìŠ¤ì¼€ì¤„ë§ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        .main-scheduling-area {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 24px;
            margin: 16px 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .disease-selection, .work-schedule-setup, .active-schedule {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin: 16px 0;
        }

        .disease-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .disease-btn {
            background: #ffffff;
            color: #374151;
            border: 1px solid #d1d5db;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.15s ease;
        }

        .disease-btn:hover {
            border-color: #9ca3af;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .disease-btn.selected {
            background: #eff6ff;
            border-color: #2563eb;
            color: #1d4ed8;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .selected-info {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
            color: #374151;
        }
        
        /* AI ì„¤ì • ì˜ì—­ ìŠ¤íƒ€ì¼ */
        .ai-settings {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin: 16px 0;
        }
        
        .ai-controls {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .ai-status {
            font-size: 0.875rem;
            padding: 8px 12px;
            background: #f3f4f6;
            border-radius: 6px;
            display: inline-block;
        }
        
        .ai-status.connected {
            background: #d1fae5;
            color: #065f46;
        }
        
        .ai-status.disconnected {
            background: #fee2e2;
            color: #991b1b;
        }
        
        /* AI ì¶”ì²œ ìŠ¤íƒ€ì¼ */
        .ai-recommendation {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 16px;
            margin-top: 12px;
        }
        
        .ai-label {
            color: #0369a1;
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .recommendation-list {
            list-style: none;
            padding: 0;
            margin: 8px 0;
        }
        
        .recommendation-list li {
            padding: 8px 0;
            padding-left: 24px;
            position: relative;
            line-height: 1.6;
        }
        
        .recommendation-list li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #10b981;
            font-weight: bold;
        }
        
        .ai-note {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 12px;
            font-style: italic;
        }
        
        /* í”„ë¡œê·¸ë ˆìŠ¤ë°” ìŠ¤íƒ€ì¼ - ê°œì„ ëœ ë²„ì „ */
        .progress-container {
            margin: 24px 0;
            padding: 16px;
            background: #f9fafb;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
        }
        
        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e5e7eb;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 50%, #ec4899 100%);
            width: 0%;
            border-radius: 6px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg,
                transparent 0%,
                rgba(255, 255, 255, 0.3) 50%,
                transparent 100%
            );
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .progress-text {
            text-align: center;
            margin-top: 12px;
            font-size: 0.875rem;
            color: #4b5563;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .progress-percentage {
            font-size: 1rem;
            font-weight: 600;
            color: #3b82f6;
            margin-left: 8px;
        }
        
        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #e5e7eb;
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .ai-error {
            background: #fee2e2;
            border: 1px solid #fecaca;
            color: #991b1b;
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
        }

        .time-inputs {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }

        .time-inputs label {
            display: flex;
            flex-direction: column;
            gap: 6px;
            font-weight: 500;
            color: #374151;
            font-size: 0.875rem;
        }

        /* ì§ˆë³‘ ê²€ìƒ‰ ìŠ¤íƒ€ì¼ */
        .disease-search {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }

        .disease-search input {
            flex: 1;
        }

        .popular-diseases, .custom-diseases {
            margin: 15px 0;
        }

        .popular-diseases h5, .custom-diseases h5 {
            margin: 0 0 12px 0;
            color: #6b7280;
            font-size: 0.875rem;
            font-weight: 600;
        }

        /* ì‹¤ì‹œê°„ íƒ€ì´ë¨¸ ìŠ¤íƒ€ì¼ */
        .live-timer {
            background: #ffffff;
            border: 1px solid #10b981;
            border-radius: 12px;
            padding: 24px;
            margin-top: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }


        .timer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .timer-header h4 {
            margin: 0;
            color: #059669;
            font-size: 1.125rem;
            font-weight: 600;
        }

        .pause-btn, .stop-btn {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.15s ease;
            margin-left: 8px;
        }

        .pause-btn:hover, .stop-btn:hover {
            background: #e5e7eb;
            border-color: #9ca3af;
        }

        .timer-display {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .current-phase {
            text-align: center;
        }

        .current-phase span {
            font-size: 1.25rem;
            font-weight: 600;
            color: #059669;
            display: block;
            margin-bottom: 12px;
        }

        .phase-progress {
            background: #f3f4f6;
            border-radius: 8px;
            height: 8px;
            overflow: hidden;
            border: 1px solid #e5e7eb;
        }

        .progress-bar {
            height: 100%;
            background: #10b981;
            border-radius: 8px;
            width: 0%;
            transition: width 1s ease;
        }

        /* Analytics ì°¨íŠ¸ ìŠ¤íƒ€ì¼ */
        .empty-chart {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #9ca3af;
            font-size: 0.875rem;
        }

        .empty-chart span {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .day-label {
            font-size: 0.75rem;
            color: #6b7280;
            font-weight: 500;
        }

        .time-label {
            font-size: 0.75rem;
            color: #374151;
            font-weight: 600;
        }

        .work-bar {
            width: 100%;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-radius: 4px 4px 0 0;
            transition: all 0.3s ease;
            min-height: 8px;
        }

        .work-bar.today {
            background: linear-gradient(135deg, #059669, #10b981);
            box-shadow: 0 0 8px rgba(5, 150, 105, 0.4);
        }

        .work-bar:hover {
            transform: scaleY(1.05);
            filter: brightness(1.1);
        }

        /* Insights ìŠ¤íƒ€ì¼ */
        .insight-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .insight-item.success {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.2);
        }

        .insight-item.warning {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .insight-item.info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .insight-icon {
            font-size: 1.25rem;
        }

        .insight-text {
            color: #374151;
            font-size: 0.875rem;
            line-height: 1.4;
        }

        /* Recommendations ìŠ¤íƒ€ì¼ */
        .recommendation-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 16px;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .recommendation-icon {
            font-size: 1.5rem;
            margin-top: 2px;
        }

        .recommendation-content {
            flex: 1;
        }

        .recommendation-title {
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 4px;
        }

        .recommendation-text {
            color: #6b7280;
            font-size: 0.875rem;
            line-height: 1.4;
        }

        .timer-info {
            display: flex;
            justify-content: space-between;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
        }

        .time-remaining, .next-phase {
            text-align: center;
        }

        .time-remaining span:first-child, .next-phase span:first-child {
            display: block;
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .time-remaining span:last-child {
            font-size: 1.875rem;
            font-weight: 700;
            color: #059669;
        }

        .next-phase span:last-child {
            font-size: 1.125rem;
            font-weight: 600;
            color: #2563eb;
        }

        .daily-progress {
            margin-top: 16px;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
        }

        .daily-progress h5 {
            margin: 0 0 12px 0;
            color: #374151;
            font-weight: 600;
        }

        .progress-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
        }

        .stat-item span:first-child {
            color: #6b7280;
        }

        .stat-item span:last-child {
            font-weight: 600;
            color: #059669;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="emoji">ğŸ¥</div>
        <h1>Wonik Health</h1>
        <p class="subtitle">ì§ˆë³‘ë³„ ë§ì¶¤ ì—…ë¬´ ìŠ¤ì¼€ì¤„ë§ ì•±</p>
        
        <div class="status">
            <div class="success">âœ… Phase 4.5 ì§„í–‰ ì¤‘!</div>
            <p>ì§ˆë³‘ë³„ ë§ì¶¤ ì—…ë¬´ ìŠ¤ì¼€ì¤„ë§ì„ ì„¤ì •í•´ë³´ì„¸ìš”!</p>
        </div>

        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="tab-navigation" role="tablist" aria-label="ë©”ì¸ ë©”ë‰´">
            <button class="tab-btn active" data-tab="scheduling" role="tab" aria-selected="true" aria-controls="scheduling-tab" tabindex="0">
                ğŸ¥ ì—…ë¬´ ìŠ¤ì¼€ì¤„ë§
            </button>
            <button class="tab-btn" data-tab="analytics" role="tab" aria-selected="false" aria-controls="analytics-tab" tabindex="-1">
                ğŸ“Š íŒ¨í„´ ë¶„ì„
            </button>
            <button class="tab-btn" data-tab="medication" role="tab" aria-selected="false" aria-controls="medication-tab" tabindex="-1">
                ğŸ’Š ì•½ë¬¼ ê´€ë¦¬
            </button>
        </div>

        <!-- íƒ­ ì½˜í…ì¸  -->
        <div class="tab-content">
            <!-- ì—…ë¬´ ìŠ¤ì¼€ì¤„ë§ íƒ­ -->
            <div id="scheduling-tab" class="tab-panel active" role="tabpanel" aria-labelledby="scheduling" tabindex="0">
                <div class="main-scheduling-area">
                    <h3>ğŸ¥ ì§ˆë³‘ë³„ ë§ì¶¤ ì—…ë¬´ ìŠ¤ì¼€ì¤„ë§</h3>
                    
                    <!-- AI ì„¤ì • ì˜ì—­ -->
                    <div class="ai-settings">
                        <h4>ğŸ¤– AI ì„¤ì •</h4>
                        <div class="ai-controls">
                            <label for="ollama-model-select">AI ëª¨ë¸ ì„ íƒ:</label>
                            <select id="ollama-model-select" class="form-input" style="width: 200px;">
                                <option value="">ëª¨ë¸ ë¡œë”©ì¤‘...</option>
                            </select>
                            <button id="refresh-models-btn" class="btn btn-secondary">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                        </div>
                        <div class="ai-status" id="ai-status">
                            <span>âšª Ollama ìƒíƒœ í™•ì¸ì¤‘...</span>
                        </div>
                    </div>
                    
                    <!-- ì§ˆë³‘ ì„ íƒ -->
                    <div class="disease-selection">
                        <h4>ğŸ“‹ ì§ˆë³‘ ì„ íƒ</h4>
                        
                        <!-- ì§ˆë³‘ ê²€ìƒ‰ ì…ë ¥ì°½ -->
                        <div class="disease-search">
                            <input type="text" id="disease-search-input" placeholder="ì§ˆë³‘ëª…ì„ ê²€ìƒ‰í•˜ì„¸ìš” (ì˜ˆ: í¸ë‘í†µ, ë‹¹ë‡¨ë³‘, ê³ í˜ˆì••...)" class="form-input">
                            <button id="add-disease-btn" class="add-btn">â• ì¶”ê°€</button>
                        </div>
                        
                        <!-- ìì£¼ ì‚¬ìš©í•˜ëŠ” ì§ˆë³‘ -->
                        <div class="popular-diseases">
                            <h5>ìì£¼ ì‚¬ìš©í•˜ëŠ” ì§ˆë³‘</h5>
                            <div class="disease-options">
                                <button class="disease-btn" data-disease="migraine">
                                    ğŸ§  í¸ë‘í†µ
                                </button>
                                <button class="disease-btn" data-disease="disc">
                                    ğŸ¦´ ë””ìŠ¤í¬/ëª©ë””ìŠ¤í¬
                                </button>
                                <button class="disease-btn" data-disease="diabetes">
                                    ğŸ©¸ ë‹¹ë‡¨ë³‘
                                </button>
                                <button class="disease-btn" data-disease="arthritis">
                                    ğŸ¦´ ê´€ì ˆì—¼
                                </button>
                            </div>
                        </div>
                        
                        <!-- ì¶”ê°€ëœ ì§ˆë³‘ ëª©ë¡ -->
                        <div class="custom-diseases">
                            <h5>ë‚´ê°€ ì¶”ê°€í•œ ì§ˆë³‘</h5>
                            <div id="custom-disease-list" class="disease-options">
                                <!-- ì‚¬ìš©ìê°€ ì¶”ê°€í•œ ì§ˆë³‘ë“¤ì´ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤ -->
                            </div>
                        </div>
                        
                        <div id="selected-disease-info" class="selected-info">
                            ì§ˆë³‘ì„ ì„ íƒí•˜ë©´ AIê°€ ë§ì¶¤ ìŠ¤ì¼€ì¤„ì„ ìƒì„±í•©ë‹ˆë‹¤.
                        </div>
                    </div>

                    <!-- ì—…ë¬´ ì‹œê°„ ì„¤ì • -->
                    <div class="work-schedule-setup">
                        <h4>â° ì—…ë¬´ ì‹œê°„ ì„¤ì •</h4>
                        <div class="time-inputs">
                            <label>
                                ì‹œì‘ ì‹œê°„:
                                <input type="time" id="work-start-time" value="09:00" class="form-input">
                            </label>
                            <label>
                                ì¢…ë£Œ ì‹œê°„:
                                <input type="time" id="work-end-time" value="18:00" class="form-input">
                            </label>
                            <button id="apply-schedule-btn" class="add-btn">ğŸ“… ìŠ¤ì¼€ì¤„ ì ìš©</button>
                        </div>
                    </div>

                    <!-- í™œì„± ìŠ¤ì¼€ì¤„ í‘œì‹œ -->
                    <div id="active-schedule" class="active-schedule">
                        <h4>ğŸ“Š í˜„ì¬ í™œì„± ìŠ¤ì¼€ì¤„</h4>
                        <div id="schedule-display" class="empty-state">
                            ì§ˆë³‘ê³¼ ì—…ë¬´ì‹œê°„ì„ ì„ íƒí•˜ì—¬ ë§ì¶¤ ìŠ¤ì¼€ì¤„ì„ ìƒì„±í•˜ì„¸ìš”.
                        </div>
                        
                        <!-- ì‹¤ì‹œê°„ íƒ€ì´ë¨¸ í‘œì‹œ -->
                        <div id="live-timer" class="live-timer" style="display: none;">
                            <div class="timer-header">
                                <h4>â±ï¸ í˜„ì¬ ì§„í–‰ ì¤‘</h4>
                                <button id="pause-timer-btn" class="pause-btn">â¸ï¸ ì¼ì‹œì •ì§€</button>
                                <button id="stop-schedule-btn" class="stop-btn">â¹ï¸ ì¤‘ì§€</button>
                            </div>
                            
                            <div class="timer-display">
                                <div class="current-phase">
                                    <span id="current-phase-name">ì—…ë¬´ ì‹œê°„</span>
                                    <div id="phase-progress" class="phase-progress">
                                        <div id="progress-bar" class="progress-bar"></div>
                                    </div>
                                </div>
                                
                                <div class="timer-info">
                                    <div class="time-remaining">
                                        <span>ë‚¨ì€ ì‹œê°„: </span>
                                        <span id="time-remaining-display">25:00</span>
                                    </div>
                                    <div class="next-phase">
                                        <span>ë‹¤ìŒ: </span>
                                        <span id="next-phase-display">5ë¶„ íœ´ì‹</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ì˜¤ëŠ˜ì˜ ì§„í–‰ ìƒí™© -->
                            <div class="daily-progress">
                                <h5>ğŸ“ˆ ì˜¤ëŠ˜ì˜ ì§„í–‰ ìƒí™©</h5>
                                <div class="progress-stats">
                                    <div class="stat-item">
                                        <span>ì™„ë£Œëœ ì—…ë¬´ ë¸”ë¡:</span>
                                        <span id="completed-blocks">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span>ì´ ì—…ë¬´ ì‹œê°„:</span>
                                        <span id="total-work-time">0ë¶„</span>
                                    </div>
                                    <div class="stat-item">
                                        <span>ì´ íœ´ì‹ ì‹œê°„:</span>
                                        <span id="total-rest-time">0ë¶„</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- íŒ¨í„´ ë¶„ì„ íƒ­ -->
            <div id="analytics-tab" class="tab-panel" role="tabpanel" aria-labelledby="analytics" tabindex="0">
                <div class="analytics-area">
                    <h3>ğŸ“Š ê°œì¸ íŒ¨í„´ ë¶„ì„</h3>
                    
                    <!-- ì˜¤ëŠ˜ì˜ ìš”ì•½ -->
                    <div class="today-summary">
                        <h4>ğŸ“… ì˜¤ëŠ˜ì˜ í™œë™ ìš”ì•½</h4>
                        <div class="summary-grid">
                            <div class="summary-card">
                                <div class="summary-icon">â°</div>
                                <div class="summary-info">
                                    <span class="summary-label">ì´ ì—…ë¬´ ì‹œê°„</span>
                                    <span class="summary-value" id="today-work-time">0ë¶„</span>
                                </div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-icon">ğŸ˜Œ</div>
                                <div class="summary-info">
                                    <span class="summary-label">ì´ íœ´ì‹ ì‹œê°„</span>
                                    <span class="summary-value" id="today-rest-time">0ë¶„</span>
                                </div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-icon">ğŸ”„</div>
                                <div class="summary-info">
                                    <span class="summary-label">ì™„ë£Œ ì‚¬ì´í´</span>
                                    <span class="summary-value" id="today-cycles">0íšŒ</span>
                                </div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-icon">ğŸ¯</div>
                                <div class="summary-info">
                                    <span class="summary-label">ì¤€ìˆ˜ìœ¨</span>
                                    <span class="summary-value" id="today-compliance">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ì£¼ê°„ íŒ¨í„´ -->
                    <div class="weekly-pattern">
                        <h4>ğŸ“ˆ ì£¼ê°„ íŒ¨í„´ ë¶„ì„</h4>
                        <div class="pattern-chart">
                            <div class="chart-header">
                                <span>ì¼ë³„ ì—…ë¬´/íœ´ì‹ ë¹„ìœ¨</span>
                                <select id="week-selector">
                                    <option value="this-week">ì´ë²ˆ ì£¼</option>
                                    <option value="last-week">ì§€ë‚œ ì£¼</option>
                                </select>
                            </div>
                            <div class="weekly-bars" id="weekly-chart">
                                <!-- ì°¨íŠ¸ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                            </div>
                        </div>
                    </div>

                    <!-- ê°œì¸í™”ëœ ì¸ì‚¬ì´íŠ¸ -->
                    <div class="insights-section">
                        <h4>ğŸ’¡ ê°œì¸í™”ëœ ì¸ì‚¬ì´íŠ¸</h4>
                        <div class="insights-grid" id="insights-container">
                            <!-- ì¸ì‚¬ì´íŠ¸ê°€ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                        </div>
                    </div>

                    <!-- ê¶Œì¥ì‚¬í•­ -->
                    <div class="recommendations">
                        <h4>ğŸ¯ ë§ì¶¤ ê¶Œì¥ì‚¬í•­</h4>
                        <div class="recommendation-list" id="recommendations-list">
                            <div class="empty-state">ì¶©ë¶„í•œ ë°ì´í„°ê°€ ìˆ˜ì§‘ë˜ë©´ ë§ì¶¤ ê¶Œì¥ì‚¬í•­ì„ ì œê³µí•©ë‹ˆë‹¤.</div>
                        </div>
                    </div>

                    <!-- ë°ì´í„° ê´€ë¦¬ -->
                    <div class="data-management">
                        <h4>ğŸ—‚ï¸ ë°ì´í„° ê´€ë¦¬</h4>
                        <div class="data-actions">
                            <button id="export-data-btn" class="add-btn" onclick="exportData()">ğŸ“¤ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
                            <button id="clear-data-btn" class="delete-btn" onclick="clearAllData()">ğŸ—‘ï¸ ë°ì´í„° ì´ˆê¸°í™”</button>
                        </div>
                        <div class="data-info">
                            <p>ìˆ˜ì§‘ëœ ë°ì´í„°: <span id="data-entries-count">0</span>ê°œ ê¸°ë¡</p>
                            <p>ë¶„ì„ ê¸°ê°„: <span id="analysis-period">ë°ì´í„° ì—†ìŒ</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì•½ë¬¼ ê´€ë¦¬ íƒ­ -->
            <div id="medication-tab" class="tab-panel" role="tabpanel" aria-labelledby="medication" tabindex="0">
                <!-- ì•½ë¬¼ ì¶”ê°€ í¼ -->
                <div class="medication-form">
                    <h3>ğŸ’Š ìƒˆ ì•½ë¬¼ ì¶”ê°€</h3>
            <div class="form-group">
                <input type="text" id="medication-name" placeholder="ì•½ë¬¼ ì´ë¦„ (ì˜ˆ: ì•„ëª¨ì˜íƒ„)" class="form-input">
                <input type="text" id="medication-dosage" placeholder="ìš©ëŸ‰ (ì˜ˆ: 5mg)" class="form-input">
                <input type="time" id="medication-time" class="form-input">
                <button id="add-medication-btn" class="add-btn">ì¶”ê°€</button>
            </div>
        </div>

        <!-- ì•½ë¬¼ ëª©ë¡ -->
        <div class="medication-list">
            <h3>ğŸ“‹ ë“±ë¡ëœ ì•½ë¬¼ <span id="medication-count">(0ê°œ)</span></h3>
            <div id="medications-container">
                <div class="empty-state">
                    ì•„ì§ ë“±ë¡ëœ ì•½ë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.<br>
                    ìœ„ì—ì„œ ì•½ë¬¼ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!
                </div>
            </div>
        </div>

                <!-- ì•Œë¦¼ í…ŒìŠ¤íŠ¸ ì˜ì—­ -->
                <div class="notification-test">
                    <h3>â° ì•Œë¦¼ í…ŒìŠ¤íŠ¸</h3>
                    <div class="test-controls">
                        <label>ì•Œë¦¼ ì˜ˆì•½ (ì´ˆ ë‹¨ìœ„):</label>
                        <select id="test-delay">
                            <option value="5">5ì´ˆ í›„</option>
                            <option value="10">10ì´ˆ í›„</option>
                            <option value="30">30ì´ˆ í›„</option>
                            <option value="60">1ë¶„ í›„</option>
                        </select>
                        <button id="schedule-test-btn" class="schedule-btn">
                            â° ì•Œë¦¼ ì˜ˆì•½
                        </button>
                    </div>
                    <div id="scheduled-notifications" class="scheduled-list">
                        <!-- ì˜ˆì•½ëœ ì•Œë¦¼ì´ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>

                <div class="test-buttons">
                    <button id="notification-btn" class="test-btn">
                        ğŸ’Š ì¦‰ì‹œ ì•Œë¦¼ í…ŒìŠ¤íŠ¸
                    </button>
                </div>
            </div>
        </div>

        <div class="version-info">
            <p>ë²„ì „: 1.0.0-alpha</p>
            <p>ê°œë°œì: ì§€í›ˆ (ì›ìµIPS UX ë””ìì´ë„ˆ)</p>
            <p>Electron ê¸°ë°˜ ë°ìŠ¤í¬í†± ì• í”Œë¦¬ì¼€ì´ì…˜</p>
        </div>
    </div>

    <script src="storage.js"></script>
    <script>
        // ê°„ë‹¨í•œ ë¡œê·¸ ì¶œë ¥
        console.log('ğŸš€ Wonik Health ì•±ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
        
        // ì €ì¥ì†Œ í™•ì¸
        if (window.medicationStorage) {
            console.log('âœ… ì•½ë¬¼ ì €ì¥ì†Œê°€ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤!');
        } else {
            console.log('âŒ ì•½ë¬¼ ì €ì¥ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
        
        // ì•ˆì „í•œ ì•Œë¦¼ í‘œì‹œ í•¨ìˆ˜
        function showSafeNotification(title, body, options = {}) {
            try {
                // ì•Œë¦¼ ì§€ì› ì²´í¬
                if (!('Notification' in window)) {
                    throw new Error('ì´ ë¸Œë¼ìš°ì €ëŠ” ì•Œë¦¼ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }

                // ê¶Œí•œ ì²´í¬
                if (Notification.permission === 'denied') {
                    throw new Error('ì•Œë¦¼ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ í—ˆìš©í•´ì£¼ì„¸ìš”.');
                }

                // ê¶Œí•œ ìš”ì²­ í›„ ì•Œë¦¼ í‘œì‹œ
                if (Notification.permission === 'default') {
                    return Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            return createNotification(title, body, options);
                        } else {
                            throw new Error('ì•Œë¦¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');
                        }
                    });
                } else {
                    return Promise.resolve(createNotification(title, body, options));
                }
            } catch (error) {
                console.error('ì•Œë¦¼ í‘œì‹œ ì‹¤íŒ¨:', error);
                alert(error.message);
                throw error;
            }
        }

        // ì‹¤ì œ ì•Œë¦¼ ìƒì„± í•¨ìˆ˜
        function createNotification(title, body, options = {}) {
            try {
                const notification = new Notification(title, {
                    body: body,
                    icon: options.icon || '',
                    tag: options.tag || 'wonik-health',
                    requireInteraction: options.requireInteraction || false,
                    silent: options.silent || false
                });

                // ì•Œë¦¼ ì´ë²¤íŠ¸ ì²˜ë¦¬
                notification.onclick = () => {
                    console.log('âœ… ì•Œë¦¼ í´ë¦­ë¨');
                    if (options.onClick) options.onClick();
                    notification.close();
                };

                notification.onshow = () => {
                    console.log('ğŸ“¢ ì•Œë¦¼ í‘œì‹œë¨');
                };

                notification.onerror = (err) => {
                    console.error('ì•Œë¦¼ í‘œì‹œ ì˜¤ë¥˜:', err);
                    alert('ì•Œë¦¼ í‘œì‹œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                };

                return notification;
            } catch (error) {
                console.error('ì•Œë¦¼ ìƒì„± ì‹¤íŒ¨:', error);
                alert('ì•Œë¦¼ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                throw error;
            }
        }

        // ì•Œë¦¼ ê¸°ëŠ¥ êµ¬í˜„ (ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”)
        document.getElementById('notification-btn').addEventListener('click', async () => {
            console.log('ğŸ’Š ì•Œë¦¼ ë²„íŠ¼ì´ í´ë¦­ë˜ì—ˆìŠµë‹ˆë‹¤!');
            
            const button = document.getElementById('notification-btn');
            const originalText = button.innerHTML;
            
            try {
                // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
                button.innerHTML = 'â³ ì „ì†¡ ì¤‘...';
                button.disabled = true;

                // ì•ˆì „í•œ ì•Œë¦¼ í‘œì‹œ
                await showSafeNotification(
                    'ğŸ’Š Wonik Health ì•Œë¦¼',
                    'ì•½ë¬¼ ë³µìš© ì‹œê°„ì…ë‹ˆë‹¤!\nê±´ê°•í•œ í•˜ë£¨ ë˜ì„¸ìš”!',
                    {
                        icon: './assets/medicine-icon.png',
                        tag: 'medicine-reminder',
                        requireInteraction: true,
                        onClick: () => {
                            alert('ì•Œë¦¼ ê¸°ëŠ¥ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤! ğŸ‰');
                        }
                    }
                );

                // ì„±ê³µ í”¼ë“œë°±
                button.innerHTML = 'âœ… ì•Œë¦¼ ì „ì†¡ë¨!';
                button.style.background = 'linear-gradient(145deg, #22c55e, #16a34a)';
                
            } catch (error) {
                // ì‹¤íŒ¨ í”¼ë“œë°±
                button.innerHTML = 'âŒ ì „ì†¡ ì‹¤íŒ¨';
                button.style.background = 'linear-gradient(145deg, #ef4444, #dc2626)';
                console.error('ì•Œë¦¼ ì „ì†¡ ì‹¤íŒ¨:', error);
            } finally {
                // ë²„íŠ¼ ë³µì›
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.style.background = 'linear-gradient(145deg, #4ade80, #22c55e)';
                    button.disabled = false;
                }, 2000);
            }
        });

        // ì•Œë¦¼ ê¶Œí•œ ìš”ì²­
        if ('Notification' in window) {
            if (Notification.permission === 'default') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        console.log('âœ… ì•Œë¦¼ ê¶Œí•œì´ í—ˆìš©ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    } else {
                        console.log('âŒ ì•Œë¦¼ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    }
                });
            }
        }
        
        // ì•½ë¬¼ ê´€ë¦¬ ê¸°ëŠ¥
        let medications = [];

        // ë°ì´í„° ê²€ì¦ í•¨ìˆ˜ë“¤
        function validateMedicationName(name) {
            if (!name || name.length < 1) {
                return { valid: false, message: 'ì•½ë¬¼ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.' };
            }
            if (name.length > 50) {
                return { valid: false, message: 'ì•½ë¬¼ ì´ë¦„ì€ 50ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.' };
            }
            if (!/^[ê°€-í£a-zA-Z0-9\s\-\.]+$/.test(name)) {
                return { valid: false, message: 'ì•½ë¬¼ ì´ë¦„ì—ëŠ” í•œê¸€, ì˜ë¬¸, ìˆ«ì, ê³µë°±, í•˜ì´í”ˆ, ë§ˆì¹¨í‘œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.' };
            }
            return { valid: true };
        }

        function validateDosage(dosage) {
            if (!dosage) return { valid: true }; // ì„ íƒì‚¬í•­
            if (dosage.length > 20) {
                return { valid: false, message: 'ìš©ëŸ‰ì€ 20ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.' };
            }
            if (!/^[0-9]+(\.[0-9]+)?\s*(mg|g|ml|ì •|ìº¡ìŠ|ì•Œ)?$/i.test(dosage)) {
                return { valid: false, message: 'ì˜¬ë°”ë¥¸ ìš©ëŸ‰ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: 5mg, 10ì •)' };
            }
            return { valid: true };
        }

        function validateTime(time) {
            if (!time) return { valid: true }; // ì„ íƒì‚¬í•­
            const timeRegex = /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;
            if (!timeRegex.test(time)) {
                return { valid: false, message: 'ì˜¬ë°”ë¥¸ ì‹œê°„ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: 08:30)' };
            }
            return { valid: true };
        }

        function sanitizeInput(input) {
            // HTML íƒœê·¸ ì œê±° ë° íŠ¹ìˆ˜ë¬¸ì ì´ìŠ¤ì¼€ì´í”„
            return input.replace(/<[^>]*>?/gm, '').replace(/[<>'"&]/g, '');
        }

        // ì•½ë¬¼ ì¶”ê°€ ê¸°ëŠ¥ (ê²€ì¦ ê°•í™”)
        document.getElementById('add-medication-btn').addEventListener('click', async () => {
            const nameInput = document.getElementById('medication-name');
            const dosageInput = document.getElementById('medication-dosage');
            const timeInput = document.getElementById('medication-time');

            const name = sanitizeInput(nameInput.value.trim());
            const dosage = sanitizeInput(dosageInput.value.trim());
            const time = timeInput.value;

            // ì…ë ¥ê°’ ê²€ì¦
            const nameValidation = validateMedicationName(name);
            if (!nameValidation.valid) {
                alert(nameValidation.message);
                nameInput.focus();
                return;
            }

            const dosageValidation = validateDosage(dosage);
            if (!dosageValidation.valid) {
                alert(dosageValidation.message);
                dosageInput.focus();
                return;
            }

            const timeValidation = validateTime(time);
            if (!timeValidation.valid) {
                alert(timeValidation.message);
                timeInput.focus();
                return;
            }

            console.log('ğŸ’Š ì•½ë¬¼ ì¶”ê°€ ì‹œë„:', { name, dosage, time });

            try {
                const result = window.medicationStorage.add({
                    name: name,
                    dosage: dosage,
                    time: time,
                    notes: ''
                });

                if (result.success) {
                    console.log('âœ… ì•½ë¬¼ì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    
                    // í¼ ì´ˆê¸°í™”
                    document.getElementById('medication-name').value = '';
                    document.getElementById('medication-dosage').value = '';
                    document.getElementById('medication-time').value = '';
                    
                    // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    loadMedications();
                    
                    // ì„±ê³µ ì•Œë¦¼
                    alert(`âœ… "${name}" ì•½ë¬¼ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                } else {
                    console.error('âŒ ì•½ë¬¼ ì¶”ê°€ ì‹¤íŒ¨:', result.error);
                    alert('ì•½ë¬¼ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                }
            } catch (error) {
                console.error('âŒ ì˜¤ë¥˜ ë°œìƒ:', error);
                alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        });

        // ì•½ë¬¼ ëª©ë¡ ë¡œë“œ
        function loadMedications() {
            try {
                console.log('ğŸ“‹ ì•½ë¬¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
                medications = window.medicationStorage.getAll();
                console.log('ë¶ˆëŸ¬ì˜¨ ì•½ë¬¼ ëª©ë¡:', medications);
                renderMedications();
                updateMedicationCount();
            } catch (error) {
                console.error('âŒ ì•½ë¬¼ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ì•½ë¬¼ ëª©ë¡ ë Œë”ë§
        function renderMedications() {
            const container = document.getElementById('medications-container');
            
            if (medications.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        ì•„ì§ ë“±ë¡ëœ ì•½ë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.<br>
                        ìœ„ì—ì„œ ì•½ë¬¼ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!
                    </div>
                `;
                return;
            }

            container.innerHTML = medications.map(med => `
                <div class="medication-item">
                    <div class="medication-info">
                        <div class="medication-header">
                            <div class="medication-name">ğŸ’Š ${med.name}</div>
                            ${med.dosage ? `<div class="dosage-badge">${med.dosage}</div>` : ''}
                        </div>
                        ${med.time ? `
                        <div class="medication-details">
                            <div class="time-icon">ğŸ•</div>
                            <span>ë³µìš©ì‹œê°„: ${med.time}</span>
                        </div>
                        ` : ''}
                        <div class="action-buttons">
                            ${med.time ? `<button class="schedule-med-btn neomorphic-btn" onclick="scheduleSpecificMedication(${med.id}, '${med.name}', '${med.dosage || ''}', '${med.time}')">â° ì•Œë¦¼ì„¤ì •</button>` : ''}
                            <button class="delete-btn neomorphic-btn" onclick="deleteMedication(${med.id})">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ì•½ë¬¼ ì‚­ì œ
        function deleteMedication(id) {
            if (!confirm('ì •ë§ë¡œ ì´ ì•½ë¬¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            try {
                console.log('ğŸ—‘ï¸ ì•½ë¬¼ ì‚­ì œ ì‹œë„:', id);
                const result = window.medicationStorage.delete(id);
                
                if (result.success) {
                    console.log('âœ… ì•½ë¬¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadMedications();
                    alert('ì•½ë¬¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    console.error('âŒ ì•½ë¬¼ ì‚­ì œ ì‹¤íŒ¨:', result.error);
                    alert('ì•½ë¬¼ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('âŒ ì˜¤ë¥˜ ë°œìƒ:', error);
                alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì•½ë¬¼ ê°œìˆ˜ ì—…ë°ì´íŠ¸
        function updateMedicationCount() {
            const count = medications.length;
            document.getElementById('medication-count').textContent = `(${count}ê°œ)`;
        }

        // ì•Œë¦¼ ìŠ¤ì¼€ì¤„ëŸ¬ ê¸°ëŠ¥
        let scheduledNotifications = [];
        let notificationIdCounter = 1;

        // ì•Œë¦¼ ì˜ˆì•½ ë²„íŠ¼ í´ë¦­
        document.getElementById('schedule-test-btn').addEventListener('click', () => {
            const delay = parseInt(document.getElementById('test-delay').value);
            const notificationId = notificationIdCounter++;
            
            const scheduledTime = new Date();
            scheduledTime.setSeconds(scheduledTime.getSeconds() + delay);
            
            const notification = {
                id: notificationId,
                scheduledTime: scheduledTime,
                delay: delay,
                medication: medications[0] || { name: 'í…ŒìŠ¤íŠ¸ ì•½ë¬¼', dosage: '5mg' }
            };
            
            scheduledNotifications.push(notification);
            
            // íƒ€ì´ë¨¸ ì„¤ì •
            notification.timeoutId = setTimeout(() => {
                showScheduledNotification(notification);
                removeScheduledNotification(notification.id);
            }, delay * 1000);
            
            // ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘
            startCountdown(notification);
            
            // UI ì—…ë°ì´íŠ¸
            updateScheduledList();
            
            // ì„±ê³µ í”¼ë“œë°±
            alert(`âœ… ì•Œë¦¼ì´ ${delay}ì´ˆ í›„ì— ì˜ˆì•½ë˜ì—ˆìŠµë‹ˆë‹¤!`);
            console.log(`â° ì•Œë¦¼ ì˜ˆì•½ë¨: ${delay}ì´ˆ í›„`);
        });

        // ì˜ˆì•½ëœ ì•Œë¦¼ í‘œì‹œ
        function showScheduledNotification(notification) {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
            
            const windowsNotification = new Notification('ğŸ’Š Wonik Health - ì•½ë¬¼ ë³µìš© ì‹œê°„', {
                body: `${notification.medication.name} ${notification.medication.dosage || ''}\në³µìš© ì‹œê°„ì…ë‹ˆë‹¤! (${timeStr})`,
                icon: './assets/medicine-icon.png',
                tag: `medication-${notification.id}`,
                requireInteraction: true
            });

            windowsNotification.onclick = () => {
                console.log('âœ… ì˜ˆì•½ëœ ì•Œë¦¼ì„ í´ë¦­í–ˆìŠµë‹ˆë‹¤!');
                alert('ì•½ë¬¼ì„ ë³µìš©í•˜ì…¨ë‚˜ìš”? ê±´ê°•í•œ í•˜ë£¨ ë˜ì„¸ìš”! ğŸ’ª');
                windowsNotification.close();
            };

            console.log(`ğŸ”” ì˜ˆì•½ëœ ì•Œë¦¼ì´ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤! (${timeStr})`);
        }

        // ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘
        function startCountdown(notification) {
            notification.intervalId = setInterval(() => {
                const now = new Date();
                const remaining = Math.max(0, Math.floor((notification.scheduledTime - now) / 1000));
                
                if (remaining <= 0) {
                    clearInterval(notification.intervalId);
                }
                
                updateScheduledList();
            }, 1000);
        }

        // ì˜ˆì•½ëœ ì•Œë¦¼ ì œê±°
        function removeScheduledNotification(id) {
            const index = scheduledNotifications.findIndex(n => n.id === id);
            if (index > -1) {
                const notification = scheduledNotifications[index];
                
                // íƒ€ì´ë¨¸ ì·¨ì†Œ
                if (notification.timeoutId) {
                    clearTimeout(notification.timeoutId);
                }
                if (notification.intervalId) {
                    clearInterval(notification.intervalId);
                }
                
                scheduledNotifications.splice(index, 1);
                updateScheduledList();
            }
        }

        // ì˜ˆì•½ ëª©ë¡ UI ì—…ë°ì´íŠ¸
        function updateScheduledList() {
            const container = document.getElementById('scheduled-notifications');
            
            if (scheduledNotifications.length === 0) {
                container.innerHTML = '<div class="empty-state">ì˜ˆì•½ëœ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            container.innerHTML = scheduledNotifications.map(notification => {
                const now = new Date();
                const remaining = Math.max(0, Math.floor((notification.scheduledTime - now) / 1000));
                const minutes = Math.floor(remaining / 60);
                const seconds = remaining % 60;
                const timeStr = minutes > 0 ? `${minutes}ë¶„ ${seconds}ì´ˆ` : `${seconds}ì´ˆ`;
                
                return `
                    <div class="scheduled-item">
                        <div class="scheduled-info">
                            ğŸ’Š ${notification.medication.name} 
                            <span class="countdown">${remaining > 0 ? timeStr + ' í›„' : 'ì•Œë¦¼ ì™„ë£Œ'}</span>
                        </div>
                        ${remaining > 0 ? `<button class="cancel-btn" onclick="removeScheduledNotification(${notification.id})">ì·¨ì†Œ</button>` : ''}
                    </div>
                `;
            }).join('');
        }

        // íŠ¹ì • ì•½ë¬¼ì— ëŒ€í•œ ì•Œë¦¼ ì„¤ì •
        function scheduleSpecificMedication(id, name, dosage, time) {
            const [hours, minutes] = time.split(':').map(Number);
            const now = new Date();
            const scheduledTime = new Date();
            
            scheduledTime.setHours(hours, minutes, 0, 0);
            
            // ì´ë¯¸ ì§€ë‚œ ì‹œê°„ì´ë©´ ë‹¤ìŒ ë‚ ë¡œ ì„¤ì •
            if (scheduledTime <= now) {
                scheduledTime.setDate(scheduledTime.getDate() + 1);
            }
            
            const timeDiff = scheduledTime - now;
            const minutesUntil = Math.floor(timeDiff / 1000 / 60);
            
            // ë°ëª¨ë¥¼ ìœ„í•´ 1ë¶„ ì´ë‚´ë¡œ ì„¤ì •
            const demoDelay = Math.min(60, Math.max(10, minutesUntil * 60)); // ìµœì†Œ 10ì´ˆ, ìµœëŒ€ 60ì´ˆ
            
            const notificationId = notificationIdCounter++;
            const demoScheduledTime = new Date();
            demoScheduledTime.setSeconds(demoScheduledTime.getSeconds() + demoDelay);
            
            const notification = {
                id: notificationId,
                scheduledTime: demoScheduledTime,
                delay: demoDelay,
                medication: { id, name, dosage, time }
            };
            
            scheduledNotifications.push(notification);
            
            // íƒ€ì´ë¨¸ ì„¤ì •
            notification.timeoutId = setTimeout(() => {
                showScheduledNotification(notification);
                removeScheduledNotification(notification.id);
            }, demoDelay * 1000);
            
            // ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘
            startCountdown(notification);
            
            // UI ì—…ë°ì´íŠ¸
            updateScheduledList();
            
            // ì„±ê³µ í”¼ë“œë°±
            alert(`âœ… ${name} ì•Œë¦¼ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!\nì›ë˜ ì‹œê°„: ${time}\në°ëª¨ë¥¼ ìœ„í•´ ${demoDelay}ì´ˆ í›„ì— ì•Œë¦¼ì´ ìš¸ë¦½ë‹ˆë‹¤.`);
            console.log(`â° ${name} ì•Œë¦¼ ì˜ˆì•½ë¨: ${time} (ë°ëª¨: ${demoDelay}ì´ˆ í›„)`);
        }

        // ì•½ë¬¼ì— ì‹¤ì œ ì‹œê°„ ê¸°ë°˜ ì•Œë¦¼ ì„¤ì •
        function scheduleMedicationNotifications() {
            medications.forEach(med => {
                if (med.time) {
                    const [hours, minutes] = med.time.split(':').map(Number);
                    const now = new Date();
                    const scheduledTime = new Date();
                    
                    scheduledTime.setHours(hours, minutes, 0, 0);
                    
                    // ì´ë¯¸ ì§€ë‚œ ì‹œê°„ì´ë©´ ë‹¤ìŒ ë‚ ë¡œ ì„¤ì •
                    if (scheduledTime <= now) {
                        scheduledTime.setDate(scheduledTime.getDate() + 1);
                    }
                    
                    const timeDiff = scheduledTime - now;
                    
                    console.log(`â° ${med.name} ì•Œë¦¼ ì˜ˆì•½: ${med.time} (${Math.floor(timeDiff / 1000 / 60)}ë¶„ í›„)`);
                    
                    // ì‹¤ì œ ì•Œë¦¼ ì˜ˆì•½ (ë‚˜ì¤‘ì— êµ¬í˜„)
                    // setTimeout(() => { ... }, timeDiff);
                }
            });
        }

        // íƒ­ ì „í™˜ ê¸°ëŠ¥ (ì ‘ê·¼ì„± ê°•í™”)
        function initTabs() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabPanels = document.querySelectorAll('.tab-panel');

            tabBtns.forEach((btn, index) => {
                // í´ë¦­ ì´ë²¤íŠ¸
                btn.addEventListener('click', () => {
                    switchTab(btn, tabBtns, tabPanels);
                });
                
                // í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜
                btn.addEventListener('keydown', (e) => {
                    handleTabKeydown(e, tabBtns, tabPanels, index);
                });
            });
        }

        // íƒ­ ì „í™˜ í•¨ìˆ˜
        function switchTab(activeButton, allButtons, allPanels) {
            const targetTab = activeButton.getAttribute('data-tab');
            
            // ëª¨ë“  íƒ­ ë²„íŠ¼ê³¼ íŒ¨ë„ ë¹„í™œì„±í™”
            allButtons.forEach(btn => {
                btn.classList.remove('active');
                btn.setAttribute('aria-selected', 'false');
                btn.setAttribute('tabindex', '-1');
            });
            allPanels.forEach(panel => {
                panel.classList.remove('active');
            });
            
            // í™œì„± íƒ­ ì„¤ì •
            activeButton.classList.add('active');
            activeButton.setAttribute('aria-selected', 'true');
            activeButton.setAttribute('tabindex', '0');
            
            const targetPanel = document.getElementById(`${targetTab}-tab`);
            targetPanel.classList.add('active');
            
            console.log(`ğŸ“‹ ${targetTab} íƒ­ìœ¼ë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        // í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ í•¸ë“¤ëŸ¬
        function handleTabKeydown(e, tabButtons, tabPanels, currentIndex) {
            let newIndex = currentIndex;
            
            switch(e.key) {
                case 'ArrowLeft':
                case 'ArrowUp':
                    e.preventDefault();
                    newIndex = currentIndex > 0 ? currentIndex - 1 : tabButtons.length - 1;
                    break;
                case 'ArrowRight':
                case 'ArrowDown':
                    e.preventDefault();
                    newIndex = currentIndex < tabButtons.length - 1 ? currentIndex + 1 : 0;
                    break;
                case 'Home':
                    e.preventDefault();
                    newIndex = 0;
                    break;
                case 'End':
                    e.preventDefault();
                    newIndex = tabButtons.length - 1;
                    break;
                case 'Enter':
                case ' ':
                    e.preventDefault();
                    switchTab(tabButtons[currentIndex], tabButtons, tabPanels);
                    return;
                default:
                    return;
            }
            
            // ìƒˆ íƒ­ìœ¼ë¡œ í¬ì»¤ìŠ¤ ì´ë™
            tabButtons[newIndex].focus();
        }

        // ì§ˆë³‘ ë°ì´í„°ë² ì´ìŠ¤ (í™•ì¥ ê°€ëŠ¥)
        let customDiseases = JSON.parse(localStorage.getItem('customDiseases') || '[]');
        
        const diseaseDatabase = {
            // ê¸°ë³¸ ì§ˆë³‘ë“¤
            migraine: {
                name: 'í¸ë‘í†µ',
                icon: 'ğŸ§ ',
                description: 'í¸ë‘í†µ í™˜ìë¥¼ ìœ„í•œ ë§ì¶¤ ìŠ¤ì¼€ì¤„ì…ë‹ˆë‹¤.',
                workDuration: 120, // ë¶„
                restDuration: 15,
                workPattern: '2ì‹œê°„ ì§‘ì¤‘ ì—…ë¬´ â†’ 15ë¶„ íœ´ì‹ (ì–´ë‘ìš´ ê³³ì—ì„œ)',
                recommendations: ['ë°ì€ í™”ë©´ í”¼í•˜ê¸°', 'ê·œì¹™ì ì¸ ìˆ˜ë¶„ ì„­ì·¨', 'ëª©ê³¼ ì–´ê¹¨ ìŠ¤íŠ¸ë ˆì¹­']
            },
            disc: {
                name: 'ë””ìŠ¤í¬/ëª©ë””ìŠ¤í¬',
                icon: 'ğŸ¦´',
                description: 'ì²™ì¶” ê±´ê°•ì„ ìœ„í•œ ë§ì¶¤ ìŠ¤ì¼€ì¤„ì…ë‹ˆë‹¤.',
                workDuration: 60,
                restDuration: 10,
                workPattern: '1ì‹œê°„ ì—…ë¬´ â†’ 10ë¶„ ìì„¸ êµì • ë° ìŠ¤íŠ¸ë ˆì¹­',
                recommendations: ['ì˜¬ë°”ë¥¸ ì•‰ì€ ìì„¸ ìœ ì§€', 'ëª©ê³¼ í—ˆë¦¬ ìŠ¤íŠ¸ë ˆì¹­', 'ì •ê¸°ì ì¸ ìì„¸ ì²´í¬']
            },
            diabetes: {
                name: 'ë‹¹ë‡¨ë³‘',
                icon: 'ğŸ©¸',
                description: 'í˜ˆë‹¹ ê´€ë¦¬ë¥¼ ìœ„í•œ ë§ì¶¤ ìŠ¤ì¼€ì¤„ì…ë‹ˆë‹¤.',
                workDuration: 90,
                restDuration: 15,
                workPattern: '1.5ì‹œê°„ ì—…ë¬´ â†’ 15ë¶„ í˜ˆë‹¹ ì²´í¬ ë° ê°€ë²¼ìš´ í™œë™',
                recommendations: ['ì •ì‹œ ì‹ì‚¬', 'í˜ˆë‹¹ ì²´í¬', 'ê°€ë²¼ìš´ ìš´ë™']
            },
            arthritis: {
                name: 'ê´€ì ˆì—¼',
                icon: 'ğŸ¦´',
                description: 'ê´€ì ˆ ê±´ê°•ì„ ìœ„í•œ ë§ì¶¤ ìŠ¤ì¼€ì¤„ì…ë‹ˆë‹¤.',
                workDuration: 90,
                restDuration: 10,
                workPattern: '1.5ì‹œê°„ ì—…ë¬´ â†’ 10ë¶„ ê´€ì ˆ ìš´ë™',
                recommendations: ['ê´€ì ˆ ìŠ¤íŠ¸ë ˆì¹­', 'ì˜¨ì°œì§ˆ', 'ë¬´ë¦¬í•œ ë™ì‘ í”¼í•˜ê¸°']
            },
            // ì¶”ê°€ ì§ˆë³‘ë“¤ì„ ì—¬ê¸°ì— ê³„ì† ì¶”ê°€í•  ìˆ˜ ìˆìŒ
            hypertension: {
                name: 'ê³ í˜ˆì••',
                icon: 'ğŸ’“',
                description: 'í˜ˆì•• ê´€ë¦¬ë¥¼ ìœ„í•œ ë§ì¶¤ ìŠ¤ì¼€ì¤„ì…ë‹ˆë‹¤.',
                workDuration: 75,
                restDuration: 10,
                workPattern: '1ì‹œê°„ 15ë¶„ ì—…ë¬´ â†’ 10ë¶„ ì‹¬í˜¸í¡ ë° íœ´ì‹',
                recommendations: ['ê·œì¹™ì ì¸ ì‹¬í˜¸í¡', 'ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬', 'ì—¼ë¶„ ì¡°ì ˆ']
            },
            depression: {
                name: 'ìš°ìš¸ì¦',
                icon: 'ğŸŒ™',
                description: 'ì •ì‹  ê±´ê°•ì„ ìœ„í•œ ë§ì¶¤ ìŠ¤ì¼€ì¤„ì…ë‹ˆë‹¤.',
                workDuration: 60,
                restDuration: 20,
                workPattern: '1ì‹œê°„ ì—…ë¬´ â†’ 20ë¶„ ëª…ìƒ ë˜ëŠ” ì‚°ì±…',
                recommendations: ['ê·œì¹™ì ì¸ ìš´ë™', 'ì¶©ë¶„í•œ ìˆ˜ë©´', 'ì‚¬íšŒì  í™œë™']
            },
            anxiety: {
                name: 'ë¶ˆì•ˆì¥ì• ',
                icon: 'ğŸ˜°',
                description: 'ë¶ˆì•ˆ ê´€ë¦¬ë¥¼ ìœ„í•œ ë§ì¶¤ ìŠ¤ì¼€ì¤„ì…ë‹ˆë‹¤.',
                workDuration: 45,
                restDuration: 15,
                workPattern: '45ë¶„ ì—…ë¬´ â†’ 15ë¶„ ì‹¬í˜¸í¡ ë° ì´ì™„',
                recommendations: ['ì‹¬í˜¸í¡ ì—°ìŠµ', 'ì ì§„ì  ê·¼ìœ¡ ì´ì™„', 'ê·œì¹™ì ì¸ ìƒí™œ']
            }
        };

        // ì§ˆë³‘ ê²€ìƒ‰ ë° ì¶”ê°€ ê¸°ëŠ¥
        function initDiseaseSearch() {
            const searchInput = document.getElementById('disease-search-input');
            const addBtn = document.getElementById('add-disease-btn');
            const customList = document.getElementById('custom-disease-list');

            // ì§ˆë³‘ ì¶”ê°€ ê¸°ëŠ¥
            addBtn.addEventListener('click', () => {
                const diseaseName = searchInput.value.trim();
                if (!diseaseName) {
                    alert('ì§ˆë³‘ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                    return;
                }

                // ì´ë¯¸ ìˆëŠ”ì§€ í™•ì¸
                const existingDisease = customDiseases.find(d => d.name.toLowerCase() === diseaseName.toLowerCase());
                if (existingDisease) {
                    alert('ì´ë¯¸ ì¶”ê°€ëœ ì§ˆë³‘ì…ë‹ˆë‹¤!');
                    return;
                }

                // ê¸°ë³¸ ì§ˆë³‘ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì°¾ê¸°
                const predefinedDisease = Object.values(diseaseDatabase).find(d => 
                    d.name.toLowerCase().includes(diseaseName.toLowerCase())
                );

                let newDisease;
                if (predefinedDisease) {
                    newDisease = { ...predefinedDisease, id: 'custom_' + Date.now() };
                } else {
                    // ì‚¬ìš©ì ì •ì˜ ì§ˆë³‘
                    newDisease = {
                        id: 'custom_' + Date.now(),
                        name: diseaseName,
                        icon: 'ğŸ¥',
                        description: `${diseaseName} í™˜ìë¥¼ ìœ„í•œ ë§ì¶¤ ìŠ¤ì¼€ì¤„ì…ë‹ˆë‹¤.`,
                        workDuration: 60, // ê¸°ë³¸ 1ì‹œê°„
                        restDuration: 10, // ê¸°ë³¸ 10ë¶„
                        workPattern: '1ì‹œê°„ ì—…ë¬´ â†’ 10ë¶„ íœ´ì‹',
                        recommendations: ['ê·œì¹™ì ì¸ íœ´ì‹', 'ì ì ˆí•œ ìš´ë™', 'ì¶©ë¶„í•œ ìˆ˜ë©´']
                    };
                }

                customDiseases.push(newDisease);
                localStorage.setItem('customDiseases', JSON.stringify(customDiseases));
                
                renderCustomDiseases();
                searchInput.value = '';
                
                alert(`âœ… "${diseaseName}" ì§ˆë³‘ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                console.log(`ğŸ¥ ìƒˆ ì§ˆë³‘ ì¶”ê°€: ${diseaseName}`);
            });

            // Enter í‚¤ë¡œ ì¶”ê°€
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addBtn.click();
                }
            });
        }

        // ì„ íƒëœ ëª¨ë¸ë¡œ AI ì¶”ì²œ ë°›ê¸°
        let selectedModel = null;
        
        // AI ì´ˆê¸°í™” í•¨ìˆ˜
        async function initializeAI() {
            // Ollama ìƒíƒœ í™•ì¸
            const statusResult = await window.electronAPI.checkOllamaStatus();
            const statusEl = document.getElementById('ai-status');
            
            if (statusResult.success && statusResult.available) {
                statusEl.className = 'ai-status connected';
                statusEl.innerHTML = '<span>ğŸŸ¢ Ollama ì—°ê²°ë¨</span>';
                
                // ëª¨ë¸ ëª©ë¡ ë¡œë“œ
                await loadOllamaModels();
            } else {
                statusEl.className = 'ai-status disconnected';
                statusEl.innerHTML = '<span>ğŸ”´ Ollama ì—°ê²° ì‹¤íŒ¨ (ê¸°ë³¸ ê¶Œì¥ì‚¬í•­ ì‚¬ìš©)</span>';
            }
        }
        
        // Ollama ëª¨ë¸ ëª©ë¡ ë¡œë“œ
        async function loadOllamaModels() {
            const selectEl = document.getElementById('ollama-model-select');
            
            try {
                const result = await window.electronAPI.getOllamaModels();
                
                if (result.success && result.models.length > 0) {
                    selectEl.innerHTML = '<option value="">ëª¨ë¸ì„ ì„ íƒí•˜ì„¸ìš”</option>';
                    
                    result.models.forEach(model => {
                        const option = document.createElement('option');
                        option.value = model.name;
                        option.textContent = `${model.name} (${model.details.parameter_size})`;
                        selectEl.appendChild(option);
                    });
                    
                    // ì²« ë²ˆì§¸ ëª¨ë¸ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„ íƒ
                    if (result.models.length > 0) {
                        selectEl.value = result.models[0].name;
                        selectedModel = result.models[0].name;
                    }
                } else {
                    selectEl.innerHTML = '<option value="">ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë¸ ì—†ìŒ</option>';
                }
            } catch (error) {
                console.error('ëª¨ë¸ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
                selectEl.innerHTML = '<option value="">ëª¨ë¸ ë¡œë“œ ì‹¤íŒ¨</option>';
            }
        }
        
        // AI ì¶”ì²œ ë°›ê¸° í•¨ìˆ˜
        async function getAIRecommendation(diseaseName, diseaseInfo, useSelectedModel = false) {
            console.log(`ğŸš¨ğŸš¨ğŸš¨ getAIRecommendation í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ì—ˆìŠµë‹ˆë‹¤!`);
            console.log(`ì§ˆë³‘ëª…: ${diseaseName}`);
            console.log(`ì§ˆë³‘ ì •ë³´:`, diseaseInfo);
            console.log(`ì„ íƒëœ ëª¨ë¸ ì‚¬ìš©: ${useSelectedModel}`);
            
            const selectedInfo = document.getElementById('selected-disease-info');
            
            if (!selectedInfo) {
                console.error('âŒ selected-disease-info ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                return;
            }
            
            console.log(`ğŸ¯ AI ì¶”ì²œ ì‹œì‘: ${diseaseName}`);
            
            // í”„ë¡œê·¸ë ˆìŠ¤ë°” HTML ìƒì„±
            selectedInfo.innerHTML = `
                <h5>ğŸ¥ ${diseaseName}</h5>
                <p>ğŸ¤– AIê°€ ë§ì¶¤ ê¶Œì¥ì‚¬í•­ì„ ìƒì„±ì¤‘ì…ë‹ˆë‹¤...</p>
                <div style="margin: 20px 0; padding: 15px; background: #f9fafb; border-radius: 8px; border: 1px solid #e5e7eb;">
                    <div style="width: 100%; height: 20px; background: #e5e7eb; border-radius: 10px; overflow: hidden;">
                        <div id="ai-progress" style="height: 100%; background: linear-gradient(90deg, #3b82f6, #8b5cf6); width: 0%; transition: width 0.3s ease; border-radius: 10px;"></div>
                    </div>
                    <div style="text-align: center; margin-top: 10px; font-size: 14px; color: #4b5563;">
                        <span id="progress-status">ì´ˆê¸°í™” ì¤‘...</span>
                        <span style="margin-left: 10px; font-weight: bold; color: #3b82f6;" id="progress-percent">0%</span>
                    </div>
                </div>
            `;
            
            // ê°„ë‹¨í•œ í”„ë¡œê·¸ë ˆìŠ¤ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
            function simpleUpdateProgress(percent, text) {
                const progressBar = document.getElementById('ai-progress');
                const progressStatus = document.getElementById('progress-status');
                const progressPercent = document.getElementById('progress-percent');
                
                if (progressBar) progressBar.style.width = percent + '%';
                if (progressStatus) progressStatus.textContent = text;
                if (progressPercent) progressPercent.textContent = Math.round(percent) + '%';
                
                console.log(`ğŸ“Š Progress: ${percent}% - ${text}`);
            }
            
            // ì´ˆê¸° í”„ë¡œê·¸ë ˆìŠ¤
            simpleUpdateProgress(5, 'ì‹œì‘ ì¤‘...');
            
            try {
                // Ollama ìƒíƒœ í™•ì¸
                await new Promise(resolve => setTimeout(resolve, 300));
                simpleUpdateProgress(15, 'Ollama ì„œë²„ í™•ì¸ì¤‘...');
                
                // electronAPI ì¡´ì¬ ì—¬ë¶€ í™•ì¸
                if (!window.electronAPI) {
                    console.warn('âš ï¸ electronAPIê°€ ì—†ìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € í™˜ê²½ì—ì„œëŠ” ê¸°ë³¸ê°’ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.');
                    simpleUpdateProgress(100, 'ë¸Œë¼ìš°ì € í™˜ê²½ - ê¸°ë³¸ê°’ ì‚¬ìš©');
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    showDefaultRecommendation(diseaseInfo);
                    return;
                }
                
                const statusResult = await window.electronAPI.checkOllamaStatus();
                
                if (statusResult.success && statusResult.available) {
                    simpleUpdateProgress(30, 'ëª¨ë¸ ì¤€ë¹„ì¤‘...');
                    await new Promise(resolve => setTimeout(resolve, 200));
                    
                    // ëª¨ë¸ ì„ íƒ
                    const selectedModel = document.getElementById('ollama-model-select').value;
                    const modelToUse = useSelectedModel ? selectedModel : null;
                    
                    simpleUpdateProgress(45, 'AI ë¶„ì„ ì‹œì‘...');
                    await new Promise(resolve => setTimeout(resolve, 300));
                    simpleUpdateProgress(60, 'AI ì¶”ì²œ ìƒì„±ì¤‘...');
                    
                    // íƒ€ì„ì•„ì›ƒ ì„¤ì • (40ì´ˆ)
                    const timeoutPromise = new Promise((_, reject) => {
                        setTimeout(() => reject(new Error('AI ì‘ë‹µ ì‹œê°„ ì´ˆê³¼')), 40000);
                    });
                    
                    // í”„ë¡œê·¸ë ˆìŠ¤ ì—…ë°ì´íŠ¸ (AI ì²˜ë¦¬ ì¤‘)
                    let aiProgress = 60;
                    const progressTimer = setInterval(() => {
                        if (aiProgress < 95) {
                            aiProgress += Math.random() * 5;
                            simpleUpdateProgress(Math.min(aiProgress, 95), 'AIê°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...');
                        }
                    }, 800);
                    
                    // Ollamaê°€ ì‚¬ìš© ê°€ëŠ¥í•œ ê²½ìš° AI ì¶”ì²œ ìš”ì²­
                    const result = await Promise.race([
                        window.electronAPI.getAIRecommendation(diseaseName, modelToUse),
                        timeoutPromise
                    ]);
                    
                    clearInterval(progressTimer);
                    simpleUpdateProgress(100, 'ì™„ë£Œ!');
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    if (result.success && result.data) {
                        const recommendation = result.data;
                        selectedInfo.innerHTML = `
                            <h5>ğŸ¥ ${diseaseName}</h5>
                            <div class="ai-recommendation">
                                <p class="ai-label">ğŸ¤– AI ë§ì¶¤ ê¶Œì¥ì‚¬í•­</p>
                                <p><strong>ğŸ“… ê¶Œì¥ íŒ¨í„´:</strong> ${recommendation.pattern}</p>
                                <p><strong>â±ï¸ ì—…ë¬´/íœ´ì‹:</strong> ${recommendation.schedule}</p>
                                <p><strong>ğŸ’¡ ê¶Œì¥ì‚¬í•­:</strong></p>
                                <ul class="recommendation-list">
                                    ${recommendation.tips.map(tip => `<li>${tip}</li>`).join('')}
                                </ul>
                                <p class="ai-note">âœ¨ Ollama AIë¡œ ìƒì„±ëœ ë§ì¶¤í˜• ê¶Œì¥ì‚¬í•­ì…ë‹ˆë‹¤</p>
                            </div>
                        `;
                    } else {
                        // AI ì¶”ì²œ ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ê°’ ì‚¬ìš©
                        clearInterval(progressTimer);
                        setProgress(100, 'ê¸°ë³¸ê°’ ì‚¬ìš©');
                        await new Promise(resolve => setTimeout(resolve, 300));
                        selectedInfo.innerHTML = `
                            <h5>ğŸ¥ ${diseaseName}</h5>
                            <div class="ai-error">
                                âš ï¸ AI ìƒì„± ì‹¤íŒ¨: ${result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}
                            </div>
                        `;
                        setTimeout(() => showDefaultRecommendation(diseaseInfo), 2000);
                    }
                } else {
                    // Ollamaë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ê°’ ì‚¬ìš©
                    simpleUpdateProgress(100, 'Ollama ì—°ê²° ì‹¤íŒ¨');
                    await new Promise(resolve => setTimeout(resolve, 500));
                    console.log('âš ï¸ Ollamaë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ì–´ ê¸°ë³¸ ê¶Œì¥ì‚¬í•­ì„ í‘œì‹œí•©ë‹ˆë‹¤.');
                    
                    selectedInfo.innerHTML = `
                        <h5>ğŸ¥ ${diseaseName}</h5>
                        <div class="ai-error">
                            âš ï¸ Ollama ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ ê¶Œì¥ì‚¬í•­ì„ í‘œì‹œí•©ë‹ˆë‹¤.
                        </div>
                    `;
                    setTimeout(() => showDefaultRecommendation(diseaseInfo), 2000);
                }
            } catch (error) {
                simpleUpdateProgress(100, 'ì˜¤ë¥˜ ë°œìƒ');
                await new Promise(resolve => setTimeout(resolve, 300));
                console.error('AI ì¶”ì²œ ì˜¤ë¥˜:', error);
                
                selectedInfo.innerHTML = `
                    <h5>ğŸ¥ ${diseaseName}</h5>
                    <div class="ai-error">
                        âš ï¸ ${error.message === 'AI ì‘ë‹µ ì‹œê°„ ì´ˆê³¼' ? 'AI ì‘ë‹µ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. (40ì´ˆ)' : `ì˜¤ë¥˜ ë°œìƒ: ${error.message}`}
                    </div>
                `;
                setTimeout(() => showDefaultRecommendation(diseaseInfo), 2000);
            }
        }
        
        // ê¸°ë³¸ ê¶Œì¥ì‚¬í•­ í‘œì‹œ í•¨ìˆ˜
        function showDefaultRecommendation(diseaseInfo) {
            const selectedInfo = document.getElementById('selected-disease-info');
            selectedInfo.innerHTML = `
                <h5>ğŸ¥ ${diseaseInfo.name}</h5>
                <p>${diseaseInfo.description || ''}</p>
                <p><strong>ğŸ“… ê¶Œì¥ íŒ¨í„´:</strong> ${diseaseInfo.workPattern || '50ë¶„ ì—…ë¬´ â†’ 10ë¶„ íœ´ì‹'}</p>
                <p><strong>â±ï¸ ì—…ë¬´/íœ´ì‹:</strong> ${diseaseInfo.workDuration || 50}ë¶„ ì—…ë¬´ â†’ ${diseaseInfo.restDuration || 10}ë¶„ íœ´ì‹</p>
                <p><strong>ğŸ’¡ ê¶Œì¥ì‚¬í•­:</strong> ${diseaseInfo.recommendations ? diseaseInfo.recommendations.join(', ') : 'ê·œì¹™ì ì¸ íœ´ì‹, ì ì ˆí•œ ìš´ë™, ì¶©ë¶„í•œ ìˆ˜ë©´'}</p>
                <p class="ai-note">ğŸ’¡ Ollama AI ì—°ê²° ì‹œ ë” ì •í™•í•œ ë§ì¶¤ ê¶Œì¥ì‚¬í•­ì„ ì œê³µí•©ë‹ˆë‹¤</p>
            `;
        }
        
        // ì‚¬ìš©ì ì •ì˜ ì§ˆë³‘ ëª©ë¡ ë Œë”ë§
        function renderCustomDiseases() {
            const customList = document.getElementById('custom-disease-list');
            
            if (customDiseases.length === 0) {
                customList.innerHTML = '<div class="empty-state">ì¶”ê°€ëœ ì§ˆë³‘ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            customList.innerHTML = customDiseases.map(disease => `
                <button class="disease-btn" data-disease="${disease.id}">
                    ${disease.icon} ${disease.name}
                </button>
            `).join('');

            // ìƒˆë¡œ ì¶”ê°€ëœ ë²„íŠ¼ë“¤ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            attachDiseaseClickEvents();
        }

        // ì§ˆë³‘ ì„ íƒ ê¸°ëŠ¥
        function initDiseaseSelection() {
            attachDiseaseClickEvents();
        }

        function attachDiseaseClickEvents() {
            const diseaseBtns = document.querySelectorAll('.disease-btn');
            const selectedInfo = document.getElementById('selected-disease-info');

            diseaseBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const diseaseId = btn.getAttribute('data-disease');
                    
                    // ëª¨ë“  ë²„íŠ¼ì—ì„œ selected í´ë˜ìŠ¤ ì œê±°
                    diseaseBtns.forEach(b => b.classList.remove('selected'));
                    
                    // í´ë¦­ëœ ë²„íŠ¼ì— selected í´ë˜ìŠ¤ ì¶”ê°€
                    btn.classList.add('selected');
                    
                    // ì§ˆë³‘ ì •ë³´ ì°¾ê¸°
                    let diseaseInfo;
                    if (diseaseId.startsWith('custom_')) {
                        diseaseInfo = customDiseases.find(d => d.id === diseaseId);
                    } else {
                        diseaseInfo = diseaseDatabase[diseaseId];
                    }

                    // ì§ˆë³‘ ì •ë³´ í‘œì‹œ
                    if (diseaseInfo) {
                        // ë¡œë”© í‘œì‹œ
                        selectedInfo.innerHTML = `
                            <h5>ğŸ¥ ${diseaseInfo.name}</h5>
                            <p>ğŸ¤– AIê°€ ë§ì¶¤ ê¶Œì¥ì‚¬í•­ì„ ìƒì„±ì¤‘ì…ë‹ˆë‹¤...</p>
                        `;
                        
                        // AI ìƒì„± ë²„íŠ¼ ìˆ¨ê¸°ê¸° (ì¡´ì¬í•˜ëŠ” ê²½ìš°ì—ë§Œ)
                        const aiControls = document.getElementById('ai-recommendation-controls');
                        if (aiControls) {
                            aiControls.style.display = 'none';
                        }
                        
                        // ì„ íƒëœ ì§ˆë³‘ ì •ë³´ ì €ì¥
                        window.selectedDiseaseInfo = diseaseInfo;
                        console.log(`ğŸ¥ ${diseaseInfo.name} ì§ˆë³‘ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤.`);
                        console.log(`ğŸ”¥ ì§€ê¸ˆ getAIRecommendation í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤!`);
                        
                        // ë°”ë¡œ AI ì¶”ì²œ ìƒì„± (ì„ íƒëœ ëª¨ë¸ ì‚¬ìš©)
                        getAIRecommendation(diseaseInfo.name, diseaseInfo, true);
                        console.log(`âœ… getAIRecommendation í•¨ìˆ˜ í˜¸ì¶œ ì™„ë£Œ!`);
                    }
                });
            });
        }

        // ìŠ¤ì¼€ì¤„ ì ìš© ê¸°ëŠ¥
        function initScheduleApply() {
            const applyBtn = document.getElementById('apply-schedule-btn');
            const scheduleDisplay = document.getElementById('schedule-display');
            
            applyBtn.addEventListener('click', () => {
                const startTime = document.getElementById('work-start-time').value;
                const endTime = document.getElementById('work-end-time').value;
                const selectedDisease = document.querySelector('.disease-btn.selected');
                
                if (!selectedDisease) {
                    alert('ë¨¼ì € ì§ˆë³‘ì„ ì„ íƒí•´ì£¼ì„¸ìš”!');
                    return;
                }
                
                if (!startTime || !endTime) {
                    alert('ì—…ë¬´ ì‹œê°„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”!');
                    return;
                }
                
                const diseaseName = selectedDisease.textContent.trim();
                
                scheduleDisplay.innerHTML = `
                    <div class="active-schedule-info">
                        <h5>ğŸ“Š í™œì„± ìŠ¤ì¼€ì¤„</h5>
                        <p><strong>ì§ˆë³‘:</strong> ${diseaseName}</p>
                        <p><strong>ì—…ë¬´ì‹œê°„:</strong> ${startTime} ~ ${endTime}</p>
                        <p><strong>ìƒíƒœ:</strong> <span style="color: #4ade80;">âœ… í™œì„±í™”ë¨</span></p>
                        <button class="add-btn" onclick="startWorkSchedule()">ğŸš€ ìŠ¤ì¼€ì¤„ ì‹œì‘</button>
                    </div>
                `;
                
                alert(`âœ… ${diseaseName} ë§ì¶¤ ìŠ¤ì¼€ì¤„ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!\nì—…ë¬´ì‹œê°„: ${startTime} ~ ${endTime}`);
                console.log(`ğŸ“… ìŠ¤ì¼€ì¤„ ì ìš©: ${diseaseName}, ${startTime}-${endTime}`);
            });
        }

        // ì—…ë¬´ ìŠ¤ì¼€ì¤„ íƒ€ì´ë¨¸ ê´€ë ¨ ë³€ìˆ˜
        let scheduleTimer = null;
        let currentPhase = 'work'; // 'work' ë˜ëŠ” 'rest'
        let timeRemaining = 0;
        let isPaused = false;
        let dailyStats = {
            completedBlocks: 0,
            totalWorkTime: 0,
            totalRestTime: 0
        };

        // íŒ¨í„´ ë¶„ì„ì„ ìœ„í•œ ë°ì´í„° ì €ì¥ì†Œ
        let analyticsData = JSON.parse(localStorage.getItem('analyticsData') || '[]');
        let sessionStartTime = null;
        let currentSessionData = null;

        // ì—…ë¬´ ìŠ¤ì¼€ì¤„ ì‹œì‘
        function startWorkSchedule() {
            if (!window.selectedDiseaseInfo) {
                alert('ë¨¼ì € ì§ˆë³‘ì„ ì„ íƒí•´ì£¼ì„¸ìš”!');
                return;
            }

            const diseaseInfo = window.selectedDiseaseInfo;
            const liveTimer = document.getElementById('live-timer');
            const scheduleDisplay = document.getElementById('schedule-display');

            // íƒ€ì´ë¨¸ í‘œì‹œ
            liveTimer.style.display = 'block';
            scheduleDisplay.style.display = 'none';

            // ì„¸ì…˜ ë°ì´í„° ì´ˆê¸°í™”
            sessionStartTime = new Date();
            currentSessionData = {
                startTime: sessionStartTime,
                disease: diseaseInfo.name,
                plannedWorkDuration: diseaseInfo.workDuration,
                plannedRestDuration: diseaseInfo.restDuration,
                actualWorkTime: 0,
                actualRestTime: 0,
                completedCycles: 0,
                interruptions: 0,
                phases: []
            };

            // ì²« ë²ˆì§¸ ì—…ë¬´ ì‹œê°„ìœ¼ë¡œ ì‹œì‘
            currentPhase = 'work';
            timeRemaining = diseaseInfo.workDuration * 60; // ë¶„ì„ ì´ˆë¡œ ë³€í™˜
            
            // ì²« ë²ˆì§¸ í˜ì´ì¦ˆ ê¸°ë¡
            currentSessionData.phases.push({
                type: 'work',
                startTime: new Date(),
                plannedDuration: diseaseInfo.workDuration * 60
            });
            
            updateTimerDisplay();
            startTimer();

            alert(`ğŸš€ ${diseaseInfo.name} ë§ì¶¤ ìŠ¤ì¼€ì¤„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!\nì—…ë¬´ì‹œê°„: ${diseaseInfo.workDuration}ë¶„ â†’ íœ´ì‹ì‹œê°„: ${diseaseInfo.restDuration}ë¶„`);
            console.log('ğŸš€ ì—…ë¬´ ìŠ¤ì¼€ì¤„ ì‹œì‘ë¨ - ë°ì´í„° ìˆ˜ì§‘ ì‹œì‘');
        }

        // íƒ€ì´ë¨¸ ì‹œì‘
        function startTimer() {
            if (scheduleTimer) {
                clearInterval(scheduleTimer);
            }

            scheduleTimer = setInterval(() => {
                if (!isPaused && timeRemaining > 0) {
                    timeRemaining--;
                    updateTimerDisplay();
                    updateProgressBar();
                } else if (timeRemaining <= 0) {
                    // í˜„ì¬ ë‹¨ê³„ ì™„ë£Œ
                    completeCurrentPhase();
                }
            }, 1000);
        }

        // íƒ€ì´ë¨¸ ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸
        function updateTimerDisplay() {
            const diseaseInfo = window.selectedDiseaseInfo;
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            const timeStr = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            document.getElementById('time-remaining-display').textContent = timeStr;
            document.getElementById('current-phase-name').textContent = 
                currentPhase === 'work' ? 'ğŸ’¼ ì—…ë¬´ ì‹œê°„' : 'ğŸ˜Œ íœ´ì‹ ì‹œê°„';

            // ë‹¤ìŒ ë‹¨ê³„ í‘œì‹œ
            if (currentPhase === 'work') {
                document.getElementById('next-phase-display').textContent = 
                    `${diseaseInfo.restDuration}ë¶„ íœ´ì‹`;
            } else {
                document.getElementById('next-phase-display').textContent = 
                    `${diseaseInfo.workDuration}ë¶„ ì—…ë¬´`;
            }

            // í†µê³„ ì—…ë°ì´íŠ¸
            document.getElementById('completed-blocks').textContent = dailyStats.completedBlocks;
            document.getElementById('total-work-time').textContent = `${dailyStats.totalWorkTime}ë¶„`;
            document.getElementById('total-rest-time').textContent = `${dailyStats.totalRestTime}ë¶„`;
        }

        // ì§„í–‰ë¥  ë°” ì—…ë°ì´íŠ¸
        function updateProgressBar() {
            const diseaseInfo = window.selectedDiseaseInfo;
            const totalTime = currentPhase === 'work' ? 
                diseaseInfo.workDuration * 60 : diseaseInfo.restDuration * 60;
            const progress = ((totalTime - timeRemaining) / totalTime) * 100;
            
            document.getElementById('progress-bar').style.width = `${progress}%`;
        }

        // í˜„ì¬ ë‹¨ê³„ ì™„ë£Œ
        function completeCurrentPhase() {
            const diseaseInfo = window.selectedDiseaseInfo;

            if (currentSessionData && currentSessionData.phases.length > 0) {
                // í˜„ì¬ í˜ì´ì¦ˆ ì™„ë£Œ ê¸°ë¡
                const currentPhaseData = currentSessionData.phases[currentSessionData.phases.length - 1];
                currentPhaseData.endTime = new Date();
                currentPhaseData.actualDuration = (currentPhaseData.endTime - currentPhaseData.startTime) / 1000;
                currentPhaseData.completed = true;
            }

            if (currentPhase === 'work') {
                // ì—…ë¬´ ì‹œê°„ ì™„ë£Œ â†’ íœ´ì‹ ì‹œê°„ìœ¼ë¡œ ì „í™˜
                dailyStats.completedBlocks++;
                dailyStats.totalWorkTime += diseaseInfo.workDuration;
                
                if (currentSessionData) {
                    currentSessionData.actualWorkTime += diseaseInfo.workDuration;
                    currentSessionData.completedCycles++;
                }
                
                showPhaseNotification('ì—…ë¬´ ì‹œê°„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'ğŸ˜Œ ì´ì œ íœ´ì‹ ì‹œê°„ì…ë‹ˆë‹¤. ì ì‹œ ì‰¬ì–´ê°€ì„¸ìš”.');
                
                currentPhase = 'rest';
                timeRemaining = diseaseInfo.restDuration * 60;
                
                // ìƒˆ íœ´ì‹ í˜ì´ì¦ˆ ì‹œì‘
                if (currentSessionData) {
                    currentSessionData.phases.push({
                        type: 'rest',
                        startTime: new Date(),
                        plannedDuration: diseaseInfo.restDuration * 60
                    });
                }
                
            } else {
                // íœ´ì‹ ì‹œê°„ ì™„ë£Œ â†’ ì—…ë¬´ ì‹œê°„ìœ¼ë¡œ ì „í™˜
                dailyStats.totalRestTime += diseaseInfo.restDuration;
                
                if (currentSessionData) {
                    currentSessionData.actualRestTime += diseaseInfo.restDuration;
                }
                
                showPhaseNotification('íœ´ì‹ ì‹œê°„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'ğŸ’¼ ì´ì œ ë‹¤ì‹œ ì—…ë¬´ë¥¼ ì‹œì‘í•˜ì„¸ìš”.');
                
                currentPhase = 'work';
                timeRemaining = diseaseInfo.workDuration * 60;
                
                // ìƒˆ ì—…ë¬´ í˜ì´ì¦ˆ ì‹œì‘
                if (currentSessionData) {
                    currentSessionData.phases.push({
                        type: 'work',
                        startTime: new Date(),
                        plannedDuration: diseaseInfo.workDuration * 60
                    });
                }
            }

            updateTimerDisplay();
            updateProgressBar();
            updateAnalytics(); // ì‹¤ì‹œê°„ ë¶„ì„ ì—…ë°ì´íŠ¸
        }

        // ë‹¨ê³„ ì „í™˜ ì•Œë¦¼
        function showPhaseNotification(title, message) {
            const notification = new Notification(`ğŸ¥ Wonik Health - ${title}`, {
                body: message,
                icon: './assets/health-icon.png',
                requireInteraction: true
            });

            notification.onclick = () => {
                console.log('âœ… ë‹¨ê³„ ì „í™˜ ì•Œë¦¼ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.');
                notification.close();
            };

            // ì‹œê°ì  ì•Œë¦¼ë„ í‘œì‹œ
            alert(`${title}\n${message}`);
        }

        // íƒ€ì´ë¨¸ ì¼ì‹œì •ì§€/ì¬ê°œ
        function initTimerControls() {
            const pauseBtn = document.getElementById('pause-timer-btn');
            const stopBtn = document.getElementById('stop-schedule-btn');

            pauseBtn.addEventListener('click', () => {
                isPaused = !isPaused;
                if (isPaused) {
                    pauseBtn.innerHTML = 'â–¶ï¸ ì¬ê°œ';
                    pauseBtn.style.background = 'linear-gradient(145deg, #22c55e, #16a34a)';
                } else {
                    pauseBtn.innerHTML = 'â¸ï¸ ì¼ì‹œì •ì§€';
                    pauseBtn.style.background = 'linear-gradient(145deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1))';
                }
                console.log(`â±ï¸ íƒ€ì´ë¨¸ ${isPaused ? 'ì¼ì‹œì •ì§€' : 'ì¬ê°œ'}`);
            });

            stopBtn.addEventListener('click', () => {
                if (confirm('ì •ë§ë¡œ ìŠ¤ì¼€ì¤„ì„ ì¤‘ì§€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    stopSchedule();
                }
            });
        }

        // ìŠ¤ì¼€ì¤„ ì¤‘ì§€
        function stopSchedule() {
            if (scheduleTimer) {
                clearInterval(scheduleTimer);
                scheduleTimer = null;
            }

            // ì„¸ì…˜ ë°ì´í„° ì €ì¥
            if (currentSessionData) {
                // ë§ˆì§€ë§‰ í˜ì´ì¦ˆ ì™„ë£Œ ì²˜ë¦¬
                if (currentSessionData.phases.length > 0) {
                    const lastPhase = currentSessionData.phases[currentSessionData.phases.length - 1];
                    if (!lastPhase.endTime) {
                        lastPhase.endTime = new Date();
                        lastPhase.actualDuration = (lastPhase.endTime - lastPhase.startTime) / 1000;
                        lastPhase.completed = false; // ì¤‘ê°„ì— ì¤‘ì§€ë¨
                        
                        if (currentSessionData) {
                            currentSessionData.interruptions++;
                        }
                    }
                }

                // ì„¸ì…˜ ì¢…ë£Œ ì‹œê°„ ê¸°ë¡
                currentSessionData.endTime = new Date();
                currentSessionData.totalDuration = (currentSessionData.endTime - currentSessionData.startTime) / 1000;

                // ì¤€ìˆ˜ìœ¨ ê³„ì‚°
                const plannedTotal = (currentSessionData.plannedWorkDuration + currentSessionData.plannedRestDuration) * currentSessionData.completedCycles;
                const actualTotal = currentSessionData.actualWorkTime + currentSessionData.actualRestTime;
                currentSessionData.complianceRate = plannedTotal > 0 ? (actualTotal / plannedTotal) * 100 : 0;

                // ë¶„ì„ ë°ì´í„°ì— ì¶”ê°€
                analyticsData.push(currentSessionData);
                localStorage.setItem('analyticsData', JSON.stringify(analyticsData));
                
                console.log('ğŸ“Š ì„¸ì…˜ ë°ì´í„° ì €ì¥ë¨:', currentSessionData);
            }

            const liveTimer = document.getElementById('live-timer');
            const scheduleDisplay = document.getElementById('schedule-display');

            liveTimer.style.display = 'none';
            scheduleDisplay.style.display = 'block';

            // í†µê³„ ë¦¬ì…‹
            dailyStats = {
                completedBlocks: 0,
                totalWorkTime: 0,
                totalRestTime: 0
            };

            isPaused = false;
            document.getElementById('pause-timer-btn').innerHTML = 'â¸ï¸ ì¼ì‹œì •ì§€';

            // ë¶„ì„ ë°ì´í„° ì—…ë°ì´íŠ¸
            updateAnalytics();

            alert('â¹ï¸ ìŠ¤ì¼€ì¤„ì´ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.\nì„¸ì…˜ ë°ì´í„°ê°€ ì €ì¥ë˜ì–´ íŒ¨í„´ ë¶„ì„ì— í™œìš©ë©ë‹ˆë‹¤.');
            console.log('â¹ï¸ ìŠ¤ì¼€ì¤„ ì¤‘ì§€ë¨ - ë°ì´í„° ì €ì¥ ì™„ë£Œ');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', () => {
            // AI ì´ˆê¸°í™”
            initializeAI();
            
            // AI ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            document.getElementById('refresh-models-btn').addEventListener('click', () => {
                initializeAI();
            });
            
            document.getElementById('ollama-model-select').addEventListener('change', (e) => {
                selectedModel = e.target.value;
                console.log('ğŸ¤– ì„ íƒëœ ëª¨ë¸:', selectedModel);
            });
            
            
            // íƒ­ ê¸°ëŠ¥ ì´ˆê¸°í™”
            initTabs();
            
            // ì§ˆë³‘ ê²€ìƒ‰ ê¸°ëŠ¥ ì´ˆê¸°í™”
            initDiseaseSearch();
            
            // ì§ˆë³‘ ì„ íƒ ê¸°ëŠ¥ ì´ˆê¸°í™”
            initDiseaseSelection();
            
            // ì‚¬ìš©ì ì •ì˜ ì§ˆë³‘ ëª©ë¡ ë Œë”ë§
            renderCustomDiseases();
            
            // ìŠ¤ì¼€ì¤„ ì ìš© ê¸°ëŠ¥ ì´ˆê¸°í™”
            initScheduleApply();
            
            // íƒ€ì´ë¨¸ ì»¨íŠ¸ë¡¤ ì´ˆê¸°í™”
            initTimerControls();
            
            // Analytics ì´ˆê¸°í™”
            updateAnalytics();
            updateDataInfo();
            
            // ì•½ë¬¼ ê´€ë¦¬ ê¸°ëŠ¥ ì´ˆê¸°í™”
            setTimeout(() => {
                if (window.medicationStorage) {
                    loadMedications();
                    console.log('ğŸ’Š ì•½ë¬¼ ì €ì¥ì†Œê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    
                    // ì‹¤ì œ ì‹œê°„ ê¸°ë°˜ ì•Œë¦¼ ìŠ¤ì¼€ì¤„ë§ (ë°ëª¨ìš©ìœ¼ë¡œ ì£¼ì„ì²˜ë¦¬)
                    // scheduleMedicationNotifications();
                }
            }, 500);
            
            console.log('ğŸ¥ ì§ˆë³‘ ê²€ìƒ‰ + ì‹¤ì‹œê°„ íƒ€ì´ë¨¸ + íŒ¨í„´ ë¶„ì„ ì‹œìŠ¤í…œì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!');
        });

        // ë¶„ì„ ë°ì´í„° ì—…ë°ì´íŠ¸
        function updateAnalytics() {
            if (!analyticsData || analyticsData.length === 0) {
                displayEmptyAnalytics();
                return;
            }

            updateTodaysSummary();
            updateWeeklyChart();
            updateInsights();
            updateRecommendations();
            updateDataInfo();
        }

        // ì˜¤ëŠ˜ì˜ í™œë™ ìš”ì•½ ì—…ë°ì´íŠ¸
        function updateTodaysSummary() {
            const today = new Date();
            const todayStr = today.toDateString();
            
            // ì˜¤ëŠ˜ì˜ ì„¸ì…˜ë“¤ í•„í„°ë§
            const todaySessions = analyticsData.filter(session => {
                const sessionDate = new Date(session.startTime);
                return sessionDate.toDateString() === todayStr;
            });

            let totalWorkTime = 0;
            let totalRestTime = 0;
            let totalCycles = 0;
            let totalCompliance = 0;

            todaySessions.forEach(session => {
                totalWorkTime += session.actualWorkTime || 0;
                totalRestTime += session.actualRestTime || 0;
                totalCycles += session.completedCycles || 0;
                
                // ìˆœì‘ë„ ê³„ì‚° (ì™„ë£Œëœ í˜ì´ì¦ˆ ìˆ˜ / ì „ì²´ í˜ì´ì¦ˆ ìˆ˜)
                const completedPhases = session.phases.filter(phase => phase.completed).length;
                const compliance = session.phases.length > 0 ? (completedPhases / session.phases.length) * 100 : 0;
                totalCompliance += compliance;
            });

            const avgCompliance = todaySessions.length > 0 ? Math.round(totalCompliance / todaySessions.length) : 0;

            // UI ì—…ë°ì´íŠ¸
            document.getElementById('today-work').textContent = `${totalWorkTime}ë¶„`;
            document.getElementById('today-rest').textContent = `${totalRestTime}ë¶„`;
            document.getElementById('today-cycles').textContent = `${totalCycles}íšŒ`;
            document.getElementById('today-compliance').textContent = `${avgCompliance}%`;
        }

        // ì£¼ê°„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateWeeklyChart() {
            const today = new Date();
            const weekData = [];
            
            // ì§€ë‚œ 7ì¼ ë°ì´í„° ìƒì„±
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                
                const dayStr = date.toDateString();
                const daySessions = analyticsData.filter(session => {
                    const sessionDate = new Date(session.startTime);
                    return sessionDate.toDateString() === dayStr;
                });

                const dayWorkTime = daySessions.reduce((sum, session) => sum + (session.actualWorkTime || 0), 0);
                const dayName = date.toLocaleDateString('ko-KR', { weekday: 'short' });

                weekData.push({
                    day: dayName,
                    workTime: dayWorkTime,
                    date: date
                });
            }

            // ìµœëŒ€ê°’ ì°¾ê¸° (ì°¨íŠ¸ ìŠ¤ì¼€ì¼ë§ìš©)
            const maxWorkTime = Math.max(...weekData.map(d => d.workTime), 1);

            // ì°¨íŠ¸ ë°” ì—…ë°ì´íŠ¸
            const barsContainer = document.querySelector('.weekly-bars');
            barsContainer.innerHTML = weekData.map(dayData => {
                const heightPercent = (dayData.workTime / maxWorkTime) * 100;
                const isToday = dayData.date.toDateString() === today.toDateString();
                
                return `
                    <div class="day-bar">
                        <div class="bar-container">
                            <div class="work-bar ${isToday ? 'today' : ''}" 
                                 style="height: ${heightPercent}%" 
                                 title="${dayData.day}: ${dayData.workTime}ë¶„">
                            </div>
                        </div>
                        <span class="day-label">${dayData.day}</span>
                        <span class="time-label">${dayData.workTime}ë¶„</span>
                    </div>
                `;
            }).join('');
        }

        // ê°œì¸í™”ëœ ì¸ì‚¬ì´íŠ¸ ì—…ë°ì´íŠ¸
        function updateInsights() {
            const insights = generateInsights();
            const insightsContainer = document.getElementById('insights-list');
            
            insightsContainer.innerHTML = insights.map(insight => `
                <div class="insight-item ${insight.type}">
                    <span class="insight-icon">${insight.icon}</span>
                    <span class="insight-text">${insight.text}</span>
                </div>
            `).join('');
        }

        // ì¸ì‚¬ì´íŠ¸ ìƒì„±
        function generateInsights() {
            const insights = [];
            const recentSessions = analyticsData.slice(-7); // ìµœê·¼ 7ê°œ ì„¸ì…˜

            if (recentSessions.length === 0) {
                return [{ type: 'info', icon: 'ğŸ’¡', text: 'ë” ë§ì€ ë°ì´í„°ê°€ ìˆ˜ì§‘ë˜ë©´ ê°œì¸í™”ëœ ì¸ì‚¬ì´íŠ¸ë¥¼ ì œê³µí•´ë“œë¦´ê²Œìš”.' }];
            }

            // í‰ê·  ìˆœì‘ë„ ê³„ì‚°
            const avgCompliance = recentSessions.reduce((sum, session) => {
                const completedPhases = session.phases.filter(phase => phase.completed).length;
                const compliance = session.phases.length > 0 ? (completedPhases / session.phases.length) * 100 : 0;
                return sum + compliance;
            }, 0) / recentSessions.length;

            // ìˆœì‘ë„ ê¸°ë°˜ ì¸ì‚¬ì´íŠ¸
            if (avgCompliance >= 80) {
                insights.push({ type: 'success', icon: 'ğŸ‰', text: 'í›Œë¥­í•©ë‹ˆë‹¤! ë†’ì€ ìˆœì‘ë„ë¥¼ ìœ ì§€í•˜ê³  ìˆì–´ìš”.' });
            } else if (avgCompliance >= 60) {
                insights.push({ type: 'warning', icon: 'ğŸ“ˆ', text: 'ìˆœì‘ë„ê°€ ê°œì„ ë˜ê³  ìˆì–´ìš”. ì¡°ê¸ˆ ë” ë…¸ë ¥í•´ë³´ì„¸ìš”!' });
            } else {
                insights.push({ type: 'info', icon: 'ğŸ’ª', text: 'ìŠ¤ì¼€ì¤„ ì¤€ìˆ˜ìœ¨ í–¥ìƒì„ ìœ„í•´ ì‘ì€ ëª©í‘œë¶€í„° ì‹œì‘í•´ë³´ì„¸ìš”.' });
            }

            // ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ëŠ” ì§ˆë³‘ íŒ¨í„´
            const diseaseCount = {};
            recentSessions.forEach(session => {
                diseaseCount[session.disease] = (diseaseCount[session.disease] || 0) + 1;
            });

            const mostUsedDisease = Object.keys(diseaseCount).reduce((a, b) => 
                diseaseCount[a] > diseaseCount[b] ? a : b, 
                Object.keys(diseaseCount)[0]
            );

            if (mostUsedDisease) {
                insights.push({ type: 'info', icon: 'ğŸ“‹', text: `${mostUsedDisease} íŒ¨í„´ì„ ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ê³  ìˆì–´ìš”.` });
            }

            // ì‹œê°„ëŒ€ ë¶„ì„
            const morningUse = recentSessions.filter(session => {
                const hour = new Date(session.startTime).getHours();
                return hour >= 6 && hour < 12;
            }).length;

            const afternoonUse = recentSessions.filter(session => {
                const hour = new Date(session.startTime).getHours();
                return hour >= 12 && hour < 18;
            }).length;

            if (morningUse > afternoonUse) {
                insights.push({ type: 'info', icon: 'ğŸŒ…', text: 'ì˜¤ì „ì— í™œë°œí•˜ê²Œ í™œë™í•˜ì‹œëŠ”êµ°ìš”!' });
            } else if (afternoonUse > morningUse) {
                insights.push({ type: 'info', icon: 'ğŸŒ‡', text: 'ì˜¤í›„ì— ë” ì§‘ì¤‘í•˜ì‹œëŠ” íŒ¨í„´ì„ ë³´ì—¬ìš”.' });
            }

            return insights;
        }

        // ì¶”ì²œì‚¬í•­ ì—…ë°ì´íŠ¸
        function updateRecommendations() {
            const recommendations = generateRecommendations();
            const recommendationsContainer = document.getElementById('recommendations-list');
            
            recommendationsContainer.innerHTML = recommendations.map(rec => `
                <div class="recommendation-item">
                    <span class="recommendation-icon">${rec.icon}</span>
                    <div class="recommendation-content">
                        <div class="recommendation-title">${rec.title}</div>
                        <div class="recommendation-text">${rec.text}</div>
                    </div>
                </div>
            `).join('');
        }

        // ì¶”ì²œì‚¬í•­ ìƒì„±
        function generateRecommendations() {
            const recommendations = [];
            const recentSessions = analyticsData.slice(-5);

            if (recentSessions.length === 0) {
                return [{
                    icon: 'ğŸš€',
                    title: 'ì²« ì„¸ì…˜ ì‹œì‘í•˜ê¸°',
                    text: 'ì§ˆë³‘ì„ ì„ íƒí•˜ê³  ì²« ë²ˆì§¸ ì—…ë¬´ ìŠ¤ì¼€ì¤„ì„ ì‹œì‘í•´ë³´ì„¸ìš”.'
                }];
            }

            // ì¤‘ë‹¨ë¥ ì´ ë†’ì€ ê²½ìš°
            const interruptionRate = recentSessions.reduce((sum, session) => 
                sum + (session.interruptions || 0), 0) / recentSessions.length;

            if (interruptionRate > 1) {
                recommendations.push({
                    icon: 'âš¡',
                    title: 'ì§§ì€ ì‹œê°„ë¶€í„° ì‹œì‘',
                    text: 'ì—…ë¬´ ì‹œê°„ì„ ì¤„ì—¬ì„œ ê¾¸ì¤€í•¨ì„ ë¨¼ì € ë§Œë“¤ì–´ë³´ì„¸ìš”.'
                });
            }

            // íœ´ì‹ ì‹œê°„ ë¶€ì¡±
            const avgRestCompliance = recentSessions.reduce((sum, session) => {
                const restPhases = session.phases.filter(phase => phase.type === 'rest');
                const completedRest = restPhases.filter(phase => phase.completed).length;
                return sum + (restPhases.length > 0 ? completedRest / restPhases.length : 0);
            }, 0) / recentSessions.length;

            if (avgRestCompliance < 0.7) {
                recommendations.push({
                    icon: 'ğŸ˜Œ',
                    title: 'íœ´ì‹ ì‹œê°„ ì§€í‚¤ê¸°',
                    text: 'ê±´ê°•í•œ ì—…ë¬´ íŒ¨í„´ì„ ìœ„í•´ íœ´ì‹ ì‹œê°„ë„ ê¼­ ì§€ì¼œì£¼ì„¸ìš”.'
                });
            }

            // ì¼ê´€ì„± ë¶€ì¡±
            const daySpread = [...new Set(recentSessions.map(session => 
                new Date(session.startTime).toDateString()
            ))].length;

            if (daySpread < recentSessions.length / 2) {
                recommendations.push({
                    icon: 'ğŸ“…',
                    title: 'ê¾¸ì¤€í•œ í™œë™',
                    text: 'ë§¤ì¼ ì¡°ê¸ˆì”©ì´ë¼ë„ í™œë™í•˜ëŠ” ê²ƒì´ ê±´ê°• ê´€ë¦¬ì— ë„ì›€ë©ë‹ˆë‹¤.'
                });
            }

            // ê¸°ë³¸ ì¶”ì²œì‚¬í•­
            if (recommendations.length === 0) {
                recommendations.push({
                    icon: 'ğŸ¯',
                    title: 'í˜„ì¬ íŒ¨í„´ ìœ ì§€',
                    text: 'ì¢‹ì€ íŒ¨í„´ì„ ìœ ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤. ê³„ì† ê¾¸ì¤€íˆ í•´ë³´ì„¸ìš”!'
                });
            }

            return recommendations.slice(0, 3); // ìµœëŒ€ 3ê°œë§Œ í‘œì‹œ
        }

        // ë¹ˆ ë¶„ì„ í™”ë©´ í‘œì‹œ
        function displayEmptyAnalytics() {
            const sections = ['today-work', 'today-rest', 'today-cycles', 'today-compliance'];
            sections.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.textContent = '0';
            });

            const barsContainer = document.querySelector('.weekly-bars');
            if (barsContainer) {
                barsContainer.innerHTML = `
                    <div class="empty-chart">
                        <span>ğŸ“Š</span>
                        <p>ë°ì´í„°ë¥¼ ìˆ˜ì§‘ ì¤‘ì…ë‹ˆë‹¤...</p>
                    </div>
                `;
            }

            const insightsContainer = document.getElementById('insights-list');
            if (insightsContainer) {
                insightsContainer.innerHTML = `
                    <div class="insight-item info">
                        <span class="insight-icon">ğŸ’¡</span>
                        <span class="insight-text">ì—…ë¬´ ìŠ¤ì¼€ì¤„ì„ ì‹œì‘í•˜ë©´ ê°œì¸í™”ëœ ë¶„ì„ì„ ì œê³µí•´ë“œë¦´ê²Œìš”.</span>
                    </div>
                `;
            }

            const recommendationsContainer = document.getElementById('recommendations-list');
            if (recommendationsContainer) {
                recommendationsContainer.innerHTML = `
                    <div class="recommendation-item">
                        <span class="recommendation-icon">ğŸš€</span>
                        <div class="recommendation-content">
                            <div class="recommendation-title">ì²« ì„¸ì…˜ ì‹œì‘í•˜ê¸°</div>
                            <div class="recommendation-text">ì§ˆë³‘ì„ ì„ íƒí•˜ê³  ì²« ë²ˆì§¸ ì—…ë¬´ ìŠ¤ì¼€ì¤„ì„ ì‹œì‘í•´ë³´ì„¸ìš”.</div>
                        </div>
                    </div>
                `;
            }
        }

        // ë°ì´í„° ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥ ì¶”ê°€
        function exportData() {
            if (!analyticsData || analyticsData.length === 0) {
                alert('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const dataToExport = {
                exportDate: new Date().toISOString(),
                totalSessions: analyticsData.length,
                data: analyticsData
            };

            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `wonik-health-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();

            alert('âœ… ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë‚´ë³´ë‚´ì¡ŒìŠµë‹ˆë‹¤!');
        }

        // ë°ì´í„° ì§€ìš°ê¸° ê¸°ëŠ¥ ì¶”ê°€
        function clearAllData() {
            if (!confirm('ì •ë§ë¡œ ëª¨ë“  ë¶„ì„ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                return;
            }

            if (!confirm('ë§ˆì§€ë§‰ í™•ì¸: ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            analyticsData = [];
            localStorage.removeItem('analyticsData');
            displayEmptyAnalytics();
            updateDataInfo();
            
            alert('âœ… ëª¨ë“  ë¶„ì„ ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            console.log('ğŸ—‘ï¸ ë¶„ì„ ë°ì´í„° ì „ì²´ ì‚­ì œë¨');
        }

        // ë°ì´í„° ì •ë³´ ì—…ë°ì´íŠ¸
        function updateDataInfo() {
            const dataCount = analyticsData ? analyticsData.length : 0;
            const dataCountElement = document.getElementById('data-entries-count');
            const analysisPeriodElement = document.getElementById('analysis-period');
            
            if (dataCountElement) {
                dataCountElement.textContent = dataCount;
            }
            
            if (analysisPeriodElement && dataCount > 0) {
                const oldestSession = new Date(Math.min(...analyticsData.map(s => new Date(s.startTime))));
                const newestSession = new Date(Math.max(...analyticsData.map(s => new Date(s.startTime))));
                
                if (oldestSession.toDateString() === newestSession.toDateString()) {
                    analysisPeriodElement.textContent = oldestSession.toLocaleDateString('ko-KR');
                } else {
                    analysisPeriodElement.textContent = 
                        `${oldestSession.toLocaleDateString('ko-KR')} ~ ${newestSession.toLocaleDateString('ko-KR')}`;
                }
            } else if (analysisPeriodElement) {
                analysisPeriodElement.textContent = 'ë°ì´í„° ì—†ìŒ';
            }
        }
    </script>
</body>
</html>